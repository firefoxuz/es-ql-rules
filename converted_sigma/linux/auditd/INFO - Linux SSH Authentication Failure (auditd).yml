name: "INFO - Linux SSH Authentication Failure (auditd)"
description: |
  Baselines failed SSH authentication events via auditd.
  Source: auditbeat auditd events (type=USER_AUTH/USER_LOGIN) with outcome=failure or res=failed.
type: esql
params: '{}'
schedule_interval: 5m
index:
  - auditbeat-*
query_language: esql
query: |
  FROM auditbeat-*
  | WHERE event.dataset == "auditd"
  | WHERE COALESCE(event.original, "") RLIKE "(?i)type=(USER_AUTH|USER_LOGIN)"
  | WHERE event.outcome == "failure"
     OR COALESCE(event.original, "") RLIKE "(?i)res=(failed|failure)"
  | STATS
      fail_count = COUNT(*),
      users = VALUES(user.name),
      user_ids = VALUES(user.id),
      src_ips = VALUES(source.ip),
      processes = VALUES(process.name),
      executables = VALUES(process.executable),
      raws = VALUES(event.original)
    BY host.name, bucket = DATE_TRUNC(10 minutes, @timestamp)
  | KEEP bucket, host.name, fail_count, users, user_ids, src_ips, processes, executables, raws
  | SORT fail_count DESC
enabled: false
tags: ["informational", "linux", "ssh", "auditd"]
severity: informational
risk_score: 1
nist: ["AU-12"]
pci_dss: ["10.2"]
gdpr: ["Article 32.1.a"]
mitre_attack: {}