rule_id: 1d96eeb0-c750-4da1-9df5-60d020ee7e7d
name: "Data Compression Detection - Linux"
description: |
  Detects data being compressed on Linux systems.
  Adversaries may compress data before exfiltration to make it harder to detect or to reduce the amount of data sent.
  Common compression tools like gzip, bzip2, tar with compression, and zip are monitored.
  Note: Legitimate system operations also use compression. Correlate with other suspicious activities.
type: esql
params: '{}'
schedule_interval: 10m
index:
  - auditbeat-*
query_language: esql
query: |
  FROM auditbeat-*
  /* auditd execve telemetry */
  | WHERE event.action == "execve" OR (event.dataset RLIKE "(?i)auditd" AND event.type == "process_started")
  /* selection: compression commands */
  | WHERE process.name IN ("gzip", "bzip2", "tar", "zip", "7z", "rar", "xz") 
    OR COALESCE(process.command_line, "") RLIKE "(?i)(tar\\s+.*(c|z)|gzip|bzip2|zip|7z|rar)"
  | STATS
      event_count = COUNT(*),
      users = VALUES(user.name),
      processes = VALUES(process.name),
      command_lines = VALUES(process.command_line),
      executables = VALUES(process.executable),
      file_paths = VALUES(file.path),
      working_directories = VALUES(process.working_directory),
      hosts = VALUES(host.name),
      raw_samples = VALUES(event.original)
    BY host.name, user.name, bucket = DATE_TRUNC(20 minutes, @timestamp)
  | WHERE event_count >= 5
  | KEEP agent_id, bucket, host.name, user.name, event_count, users, processes, command_lines, executables, file_paths, working_directories, hosts, raw_samples
  | SORT event_count DESC
enabled: false
tags:
  - attack.collection
  - attack.t1560.001
  - detection.threat-hunting
severity: low
risk_score: 30
references:
  - "https://attack.mitre.org/techniques/T1560/001/"
nist: ["SI-4", "AU-12"]
pci_dss: ["10.2"]
gdpr: ["32.1.b"]
mitre_attack:
  TA0009:
    T1560: ["T1560.001"]
