rule_id: bb0159d3-3865-43f8-973e-edf383e8aa37
name: "Kernel Ring Buffer (dmesg) Clearing Detection"
description: |
  Detects clearing or disabling of kernel ring buffer (dmesg) logs via syslog syscall.
  Adversaries may clear kernel logs to hide traces of exploitation or driver loading.
  Monitors syslog syscall with actions 4 (READ_CLEAR), 5 (CLEAR), or 6 (CONSOLE_OFF).
type: esql
params: '{}'
schedule_interval: 10m
index:
  - auditbeat-*
query_language: esql
query: |
  FROM auditbeat-*
  /* auditd SYSCALL events */
  | WHERE event.dataset RLIKE "(?i)auditd"
  /* selection: syslog syscall with clear actions */
  | WHERE (COALESCE(event.original, "") RLIKE "(?i)syscall=103" OR COALESCE(event.original, "") RLIKE "(?i)syscall=syslog")
    AND (
      COALESCE(event.original, "") RLIKE "(?i)a0=4" 
      OR COALESCE(event.original, "") RLIKE "(?i)a0=5" 
      OR COALESCE(event.original, "") RLIKE "(?i)a0=6"
    )
  | STATS
      event_count = COUNT(*),
      users = VALUES(user.name),
      processes = VALUES(process.name),
      executables = VALUES(process.executable),
      hosts = VALUES(host.name),
      raw_samples = VALUES(event.original)
    BY host.name, user.name, bucket = DATE_TRUNC(20 minutes, @timestamp)
  | WHERE event_count >= 1
  | KEEP agent_id, bucket, host.name, user.name, event_count, users, processes, executables, hosts, raw_samples
  | SORT event_count DESC
enabled: false
tags:
  - attack.defense-evasion
  - attack.t1070.002
severity: medium
risk_score: 50
references:
  - "https://man7.org/linux/man-pages/man2/syslog.2.html"
  - "https://attack.mitre.org/techniques/T1070/002/"
nist: ["SI-4", "AU-12"]
pci_dss: ["10.2"]
gdpr: ["32.1.b"]
mitre_attack:
  TA0005:
    T1070: ["T1070.002"]
