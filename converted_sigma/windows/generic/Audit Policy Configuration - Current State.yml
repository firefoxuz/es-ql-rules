rule_id: fe9f1337-9872-4371-b646-e68a0d1bd685
name: Audit Policy Configuration - Current State
description: |
  Monitors audit policy settings (Event ID 4719) for compliance verification. Tracks audit configuration state for security baseline maintenance.
type: esql
params: '{}'
schedule_interval: 1h
index:
  - winlogbeat-*
query_language: esql
query: |
  FROM winlogbeat-*
  | WHERE event.code == "4719"
  | EVAL 
      configuring_user = COALESCE(user.name, winlog.event_data.SubjectUserName, "Unknown"),
      category = COALESCE(winlog.event_data.CategoryId, "Unknown"),
      subcategory = COALESCE(winlog.event_data.SubcategoryId, "Unknown"),
      audit_changes = COALESCE(winlog.event_data.AuditPolicyChanges, "Unknown")
  | STATS 
      config_changes = COUNT(*),
      categories = VALUES(category),
      subcategories = VALUES(subcategory),
      changes = VALUES(audit_changes),
      users = VALUES(configuring_user),
      first_change = MIN(@timestamp),
      last_change = MAX(@timestamp)
    BY host.name, bucket = DATE_TRUNC(1 day, @timestamp)
  | WHERE config_changes >= 1
  | KEEP bucket, host.name, config_changes, categories, subcategories,
      changes, users, first_change, last_change
  | SORT config_changes DESC
enabled: true
tags:
  - detection.baseline
  - detection.compliance
  - monitoring.audit-policy
severity: information
risk_score: 5
