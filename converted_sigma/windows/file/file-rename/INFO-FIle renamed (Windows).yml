rule_id: 3770d496-d98b-4234-a2bd-255a5fb61307

# 4) File Renamed (generic hunting / best-effort)
name: "INFO - File Renamed (Windows) - Hunting"
description: |
  Informational baseline for file rename activity. Many pipelines do not provide both old/new names in ECS.
  This rule hunts by looking for file events that mention rename/move in event.action/type/dataset.
  If you have explicit old/new path fields, replace the logic to use them.
type: esql
params: '{}'
schedule_interval: 10m
index:
  - logs-winlog*
query_language: esql
query: |
  FROM logs-winlog*
  // Filter strictly for file category events
  | WHERE event.category == "file"
  // Target rename and move operations via type, action, or raw log content
  | WHERE (
      event.type RLIKE "(?i).*(rename|moved|move).*"
      OR event.action RLIKE "(?i).*(rename|moved|move).*"
      OR COALESCE(event.original, "") RLIKE "(?i).*(SourceFilename|TargetFilename|Rename).*"
    )
  | STATS
      event_count = COUNT(*),
      users = VALUES(winlog.event_data.TargetUserName),
      processes = VALUES(winlog.event_data.ProcessName),
      executables = VALUES(winlog.event_data.ProcessName),
      parents = VALUES(winlog.event_data.CallerProcessName),
      parent_executables = VALUES(winlog.event_data.CallerProcessName),
      paths = VALUES(winlog.event_data.OriginalFileName),
      raw_samples = VALUES(event.original)
    BY 
      host.name, 
      bucket = DATE_TRUNC(20m, @timestamp)
  | WHERE event_count >= 1
  | KEEP 
      agent_id, bucket, host.name, event_count, users, processes, executables, parents, parent_executables, paths, raw_samples
  | SORT event_count DESC
enabled: false
tags:
  - informational
  - file-monitoring
severity: informational
risk_score: 1
references:
  - "https://www.elastic.co/guide/en/ecs/current/ecs-event.html"
nist: ["AU-12"]
pci_dss: ["10.2"]
gdpr: ["32.1.a"]
mitre_attack: {}


