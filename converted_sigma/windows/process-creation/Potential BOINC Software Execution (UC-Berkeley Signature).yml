rule_id: 5e292a2b-1f00-48db-b6ea-f2930cebe6d5
name: "Potential BOINC Software Execution (UC-Berkeley Signature)"
description: |
  Detects process execution where the file metadata description indicates "University of California, Berkeley",
  which is commonly associated with BOINC volunteer computing software. BOINC can be legitimately installed,
  but in some intrusions it has been abused for unauthorized compute (crypto/mining-like behavior) or persistence.
  False positives: Expected if BOINC is intentionally installed/used.
  Triage: Validate the binary path and signer/publisher, confirm installation approval, check CPU usage spikes
  (metricbeat), persistence mechanisms (services/scheduled tasks), outbound connections, and whether the parent
  process indicates fake update chains (browser/installer from Downloads/AppData).
type: esql
params: '{}'
schedule_interval: 10m
index:
  - logs-winlog*
  - logs-metric*
query_language: esql
query: |
  FROM logs-winlog*, logs-metric*
  // Selection: Look for UC Berkeley metadata in the original log or command line
  | WHERE (
      COALESCE(event.original, "") LIKE "*University of California, Berkeley*"
      OR COALESCE(winlog.event_data.CommandLine, "") LIKE "*University of California, Berkeley*"
    )
  | EVAL hour_of_day = DATE_EXTRACT("hour", @timestamp)
  | EVAL is_after_hours = CASE(hour_of_day < 7 OR hour_of_day > 20, true, false)
  // Identify execution from common staging or "low-barrier" directories
  | EVAL suspicious_path = CASE(
      COALESCE(winlog.event_data.ProcessName, "") RLIKE "(?i).*\\\\\\\\(Users\\\\\\\\.*\\\\\\\\(AppData\\\\\\\\(Local\\\\\\\\Temp|Roaming)|Downloads)|Windows\\\\\\\\Temp|ProgramData|Users\\\\\\\\Public)\\\\\\\\.*", true,
      false
    )
  | STATS
      event_count = COUNT(*),
      users = VALUES(winlog.event_data.TargetUserName),
      processes = VALUES(winlog.event_data.ProcessName),
      executables = VALUES(winlog.event_data.ProcessName),
      parents = VALUES(winlog.event_data.CallerProcessName),
      cmdlines = VALUES(winlog.event_data.CommandLine),
      originals = VALUES(COALESCE(event.original, "")),
      after_hours_hits = SUM(CASE(is_after_hours == true, 1, 0)),
      suspicious_path_hits = SUM(CASE(suspicious_path == true, 1, 0))
    BY 
      host.name, 
      bucket = DATE_TRUNC(20m, @timestamp)
  | WHERE event_count >= 1
  // Risk Score: Base of 1 per hit; significant multipliers for night-time or suspicious locations
  | EVAL risk_score = event_count * 1 + after_hours_hits * 5 + suspicious_path_hits * 5
  | WHERE risk_score >= 1
  | KEEP 
      agent_id, bucket, host.name, event_count, users, processes, executables, 
      parents, cmdlines, after_hours_hits, suspicious_path_hits, risk_score, originals
  | SORT risk_score DESC
enabled: false
tags:
  - attack.execution
  - attack.defense-evasion
  - attack.t1553
  - detection.threat-hunting
severity: informational
risk_score: 5
references:
  - "https://boinc.berkeley.edu/"
  - "https://www.huntress.com/blog/fake-browser-updates-lead-to-boinc-volunteer-computing-software"
nist: ["AU-6", "SI-4"]
pci_dss: ["10.2"]
gdpr: ["32.1.a"]
mitre_attack:
  TA0002:
    T1553: []
