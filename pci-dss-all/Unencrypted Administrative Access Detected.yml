rule_id: 62dbd61d-8c82-4a66-94d0-328c81eb9fbc
#//RULE-PCI-06 â€” Unencrypted Admin Access (PCI 2.3)
#//Requirement: 2
#//Objective: Detect non-console administrative access without encryption
#//Data sources: Network logs, authentication logs
#//ECS fields used: event.category, event.original, event.original, user.name
#//Field validation: Verify these fields exist in your indices before enabling
#//Tuning notes: Allowlist SSH/TLS/VPN connections; alert on cleartext admin protocols

name: "Unencrypted Administrative Access Detected"
description: |
  Identifies administrative access using unencrypted protocols (Telnet, HTTP, FTP)
  instead of encrypted alternatives (SSH, HTTPS, SFTP). PCI DSS 2.3 requires strong
  cryptography for all non-console administrative access. Cleartext admin sessions
  expose credentials and session data to network sniffing. Exclude console logins
  and verify SSH/TLS usage for remote administration.
type: esql
params: '{}'
schedule_interval: 5m
index:
  - filebeat-*
  - auditbeat-*
query_language: esql
query: |
  FROM filebeat-*, auditbeat-*
  | WHERE event.category == "network"
    AND event.original == "inbound"
    AND event.original IN (23, 80, 21, 8080)  // Telnet, HTTP, FTP
    AND event.action RLIKE "(?i)(connect|login|auth)"
  | WHERE NOT (
      event.original == "tls" OR event.original == "ssh"
      OR event.original == 443
    )
  | STATS connection_count = COUNT(*),
          unique_users = COUNT_DISTINCT(user.name),
          sources = VALUES(source.ip),
          protocols = VALUES(event.original)
    BY event.original, event.original, user.name
  | WHERE connection_count > 0
  | EVAL admin_likely = CASE(
      user.name RLIKE "(?i)(admin|root|sa|dba)", 1,
      event.original == 23, 1,
      0
    )
  | WHERE admin_likely == 1
  | EVAL risk_score = CASE(
      event.original == 23, 95,
      event.original == 80 AND user.name IS NOT NULL, 85,
      70
    )
  | KEEP agent_id, event.original, event.original, user.name, connection_count, sources, protocols, risk_score
  | SORT risk_score DESC
enabled: false
tags:
  - pci_dss
  - requirement_2
  - network
  - encryption
  - administrative_access
severity: high
risk_score: 85
references:
  - "PCI DSS v3.1 Requirement 2.3"
nist: ["SC-8"]
gdpr: ["32"]
pci_dss: ["2.3"]
mitre_attack:
  TA0001: 
    T1040: []