#//RULE-PCI-23 â€” Weak Password Detected (PCI 8.2.3)
#//Requirement: 8
#//Objective: Identify accounts with passwords not meeting complexity requirements
#//Data sources: Windows Event Logs, authentication logs
#//ECS fields used: event.action, user.name, event.outcome
#//Tuning notes: Monitor password change events; integrate with password audit tools

name: "RULE-PCI-23: Weak Password Set or Password Policy Violation"
description: |
  Detects password changes that may not meet PCI DSS 8.2.3 requirements (minimum
  7 characters, alphanumeric). While ES|QL cannot directly validate password
  complexity, this rule identifies indicators such as password change failures due
  to policy violations or rapid password resets suggesting weak credentials.
  Integrate with Active Directory password policy reports for comprehensive coverage.
type: esql
params: '{}'
schedule_interval: 15m
index:
  - winlogbeat-*
  - auditbeat-*
query_language: esql
query: |
  FROM winlogbeat-*, auditbeat-*
  | WHERE event.category == "iam"
    AND event.action IN ("changed-password", "reset-password", "password_change")
    AND (
      event.outcome == "failure"
      OR winlog.event_data.FailureReason RLIKE "(?i).*(complexity|length|policy).*"
    )
  | STATS policy_violations = COUNT(*),
          users = VALUES(user.name),
          failure_reasons = VALUES(winlog.event_data.FailureReason)
    BY user.name, host.name
  | WHERE policy_violations > 2
  | EVAL risk_score = CASE(
      policy_violations > 5, 80,
      policy_violations > 3, 70,
      60
    )
  | KEEP user.name, host.name, policy_violations, failure_reasons, risk_score
  | SORT risk_score DESC
enabled: false
tags:
  - pci_dss
  - requirement_8
  - authentication
  - password_policy
  - iam
severity: medium
risk_score: 65
references:
  - "PCI DSS v3.1 Requirement 8.2.3"
nist: ["IA-5"]
gdpr: [""]
pci_dss: ["8.2.3"]
mitre_attack: []