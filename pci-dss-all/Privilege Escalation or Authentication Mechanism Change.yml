rule_id: b4ec77b9-2a41-48a8-bd3e-c104bb948072
#//RULE-PCI-35 â€” Privilege Escalation Detected (PCI 10.2.5)
#//Requirement: 10
#//Objective: Detect elevation of privileges and changes to authentication mechanisms
#//Data sources: Windows Event Logs, Linux auditd
#//ECS fields used: event.category, event.action, user.name, group.name
#//Tuning notes: Monitor sudo usage, group membership changes, privilege assignment

name: "Privilege Escalation or Authentication Mechanism Change"
description: |
  Identifies privilege escalation events including creation of new privileged accounts,
  elevation of existing user privileges, and changes to authentication mechanisms
  (password resets, new tokens, sudo rules). PCI DSS 10.2.5 requires logging use of
  and changes to identification/authentication mechanisms and privilege elevation.
  Unauthorized privilege changes indicate potential compromise or insider threat.
type: esql
params: '{}'
schedule_interval: 5m
index:
  - winlogbeat-*
  - auditbeat-*
query_language: esql
query: |
  FROM winlogbeat-*, auditbeat-*
  | WHERE event.category == "iam"
    AND (
      (event.action IN ("added-member-to-group", "group_add")
       AND group.name RLIKE "(?i).*(admin|sudo|wheel|power|domain.*admin).*")
      OR
      (event.action RLIKE "(?i).*(privilege.*assign|right.*grant|elevation).*")
      OR
      (event.action IN ("reset-password", "changed-password")
       AND user.name RLIKE "(?i).*(admin|root|sa|dba).*")
      OR
      (file.path == "/etc/sudoers" AND event.action IN ("modified", "created"))
    )
  | STATS privilege_events = COUNT(*),
          target_users = VALUES(winlog.event_data.TargetUserName),
          groups = VALUES(group.name),
          actions = VALUES(event.action),
          changed_by = VALUES(user.name)
    BY user.name, host.name
  | WHERE privilege_events > 0
  | EVAL risk_score = CASE(
      groups RLIKE "(?i).*(domain.*admin|enterprise.*admin).*", 100,
      actions RLIKE "(?i).*(reset|change).*password.*", 90,
      privilege_events > 3, 85,
      75
    )
  | KEEP agent_id, user.name, host.name, privilege_events, target_users, groups, actions, changed_by, risk_score
  | SORT risk_score DESC
enabled: false
tags:
  - pci_dss
  - requirement_10
  - logging
  - privilege_escalation
  - iam
severity: high
risk_score: 85
references:
  - "PCI DSS v3.1 Requirement 10.2.5"
nist: ["AU-12"]
gdpr: ["32"]
pci_dss: ["10.2.5"]
mitre_attack:
  TA0004:
    T1078.003: []
