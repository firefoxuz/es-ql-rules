#//RULE-PCI-27 â€” Terminated User Access Not Revoked (PCI 8.1.3)
#//Requirement: 8
#//Objective: Detect authentication by terminated employee accounts
#//Data sources: HR termination data, authentication logs
#//ECS fields used: event.category, user.name, event.outcome, @timestamp
#//Tuning notes: Integrate with HR system; maintain terminated user list; alert on post-termination logins

name: "RULE-PCI-27: Authentication by Terminated User Account"
description: |
  Detects successful authentication using accounts belonging to terminated employees.
  PCI DSS 8.1.3 requires immediate revocation of access for terminated users.
  Post-termination access indicates incomplete offboarding procedures or compromised
  credentials. Requires integration with HR termination data or manual terminated
  user list. Correlate with physical access logs and investigate immediately.
type: esql
params: '{}'
schedule_interval: 5m
index:
  - winlogbeat-*
  - auditbeat-*
query_language: esql
query: |
  FROM winlogbeat-*, auditbeat-*
  | WHERE event.category == "authentication"
    AND event.outcome == "success"
    AND user.name IN ("terminated.user1", "former.employee2", "separated.staff3")
  | STATS access_count = COUNT(*),
          sources = VALUES(source.ip),
          systems = VALUES(host.name),
          first_access = MIN(@timestamp),
          last_access = MAX(@timestamp)
    BY user.name
  | WHERE access_count > 0
  | EVAL risk_score = 100
  | KEEP user.name, access_count, sources, systems, first_access, last_access, risk_score
  | SORT first_access ASC
enabled: false
tags:
  - pci_dss
  - requirement_8
  - iam
  - terminated_user
  - insider_threat
severity: critical
risk_score: 100
references:
  - "PCI DSS v3.1 Requirement 8.1.3"
nist: ["AC-2"]
gdpr: ["Article 32"]
pci_dss: ["8.1.3"]
mitre_attack:
  TA0001:
    T1078: ["T1078.001"]
