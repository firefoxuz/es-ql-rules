rule_id: 967e4531-f34e-4e18-b027-0f89c9e6f3fc
#//EVIDENCE-PCI-01 — Network Diagrams and Documentation (PCI 1.1.2, 1.1.3, 1.1.5, 1.1.6)
#//Requirement: 1
#//Objective: Evidence of current network/data flow diagrams and documentation
#//Why not detectable: These are documentation and governance requirements requiring
#//manual audit of network diagrams, data flow maps, role definitions, and service
#//justification documents. ES|QL cannot validate diagram accuracy or documentation
#//completeness. Compliance verified through artifact review and interviews.
#//RULE-PCI-04 — Default Credentials Usage Attempt (PCI 2.1)
#//Requirement: 2
#//Objective: Detect authentication with vendor default credentials
#//Data sources: Windows Event Logs, Linux auditd, application logs
#//ECS fields used: event.category, event.outcome, user.name, source.ip
#//Tuning notes: Maintain list of default usernames; allowlist initial setup activities

name: "Default Credential Authentication Attempt"
description: |
  Identifies authentication attempts using known vendor default usernames (admin,
  administrator, root, guest, etc.) that should have been changed per PCI DSS 2.1.
  Successful logins with default accounts indicate incomplete hardening or potential
  compromise using publicly known credentials. False positives may occur during
  initial system deployment; exclude setup windows and verify credential rotation.
type: esql
params: '{}'
schedule_interval: 5m
index:
  - winlogbeat-*
  - auditbeat-*
query_language: esql
query: |
  FROM winlogbeat-*, auditbeat-*
  | WHERE event.category == "authentication"
    AND user.name IS NOT NULL
    AND user.name RLIKE "(?i)(admin|administrator|root|guest|oracle|sa|postgres|mysql|test|demo|default|support)"
  | STATS auth_attempts = COUNT(*),
          success_count = COUNT_IF(event.outcome == "success"),
          failure_count = COUNT_IF(event.outcome == "failure"),
          sources = VALUES(source.ip),
          hosts = VALUES(host.name)
    BY user.name, source.ip
  | WHERE auth_attempts > 0
  | EVAL risk_score = CASE(
      success_count > 0 AND user.name IN ("root", "admin", "administrator"), 100,
      success_count > 0, 85,
      failure_count > 10, 70,
      failure_count > 3, 55,
      40
    )
  | KEEP agent_id, user.name, source.ip, auth_attempts, success_count, failure_count, hosts, risk_score
  | SORT risk_score DESC
enabled: false
tags:
  - pci_dss
  - requirement_2
  - authentication
  - default_credentials
  - initial_access
severity: critical
risk_score: 85
references:
  - "PCI DSS v3.1 Requirement 2.1"
nist: ["IA-5"]
gdpr: ["32"]
pci_dss: ["2.1", "2.1.1"]
mitre_attack:
  TA0005:
    T1078: ["T1078.001"]