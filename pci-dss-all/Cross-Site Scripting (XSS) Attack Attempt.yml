rule_id: 71182724-b639-424a-94d9-5c37b10f4225
#//RULE-PCI-18 â€” Cross-Site Scripting (XSS) Attempt (PCI 6.5.7)
#//Requirement: 6
#//Objective: Detect XSS attack attempts in web requests
#//Data sources: Web access logs (nginx), WAF logs
#//ECS fields used: event.original, event.original, source.ip, event.original
#//Tuning notes: Monitor for script tags and JavaScript event handlers; exclude CDN

name: "Cross-Site Scripting (XSS) Attack Attempt"
description: |
  Detects potential Cross-Site Scripting attacks through web request parameters
  containing JavaScript code, HTML script tags, or event handlers. PCI DSS 6.5.7
  requires addressing XSS vulnerabilities in web applications. Patterns include
  <script> tags, onerror/onload handlers, and JavaScript protocol URIs. Correlate
  with application responses (reflected XSS) and user session activity.
type: esql
params: '{}'
schedule_interval: 5m
index:
  - filebeat-nginx-access-*
query_language: esql
query: |
  FROM filebeat-nginx-access-*
  | WHERE event.category == "web"
    AND (
      event.original RLIKE "(?i).*(<script|<iframe|<svg|<embed|<object|javascript:|data:text\\/html|onerror|onload|onmouseover|onfocus|eval\\(|alert\\(|document\\.|window\\.|String\\.fromCharCode|&#[0-9]+;|\\u[0-9a-f]{4}|%3c|%3e).*"
      OR event.original RLIKE "(?i).*(<script|<iframe|<svg|<embed|javascript:|onerror|onload|eval\\(|alert\\(|document\\.|String\\.fromCharCode|&#|\\u[0-9a-f]{4}).*"
      OR event.original RLIKE "(?i).*(<script|javascript:|data:text).*"
    )
  | STATS attempt_count = COUNT(*),
          urls = VALUES(event.original),
          queries = VALUES(event.original),
          user_agents = VALUES(event.original),
          referrers = VALUES(event.original)
    BY source.ip, event.original
  | WHERE attempt_count > 0
  | EVAL attack_vector = CASE(
      queries RLIKE "(?i).*(<svg|<embed|<object).*", "SVG/XML-Based XSS",
      queries RLIKE "(?i).*(<script|<iframe).*", "Script/Iframe Injection",
      queries RLIKE "(?i).*(javascript:|data:text).*", "Protocol Handler XSS",
      queries RLIKE "(?i).*(onerror|onload|onmouseover|onfocus).*", "Event Handler XSS",
      queries RLIKE "(?i).*(String\\.fromCharCode|&#[0-9]+;|\\u[0-9a-f]{4}|%3c).*", "Obfuscated/Encoded XSS",
      queries RLIKE "(?i).*(window\\.|document\\.|location\\.).*", "DOM-Based XSS Indicator",
      "Generic XSS"
    )
  | EVAL risk_score = CASE(
      attack_vector RLIKE "(?i).*obfuscated.*", 95,
      attempt_count > 5, 90,
      attack_vector == "SVG/XML-Based XSS", 85,
      attack_vector == "DOM-Based XSS Indicator", 80,
      70
    )
  | KEEP agent_id, source.ip, event.original, attempt_count, attack_vector, queries, user_agents, risk_score
  | SORT risk_score DESC
  | LIMIT 100
enabled: false
tags:
  - pci_dss
  - requirement_6
  - web
  - xss
  - attack
severity: high
risk_score: 85
references:
  - "PCI DSS v3.1 Requirement 6.5.7"
  - "OWASP Top 10 A7:2017"
nist: ["IA-5"]
gdpr: ["32"]
pci_dss: ["6.5.7"]
mitre_attack:
  TA0001:
    T1189: []
