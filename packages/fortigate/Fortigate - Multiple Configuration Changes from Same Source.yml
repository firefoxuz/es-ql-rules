rule_id: 4b7e3b09-cd83-4f64-a147-ed26f88fdfb4
name: Fortigate - Multiple Configuration Changes from Same Source
description: |
  Ushbu qoida Fortigate firewall'da bir xil manbadan qisqa vaqt ichida ko'p konfiguratsiya o'zgarishlarini aniqlaydi.
  Bu defense evasion (T1089) belgisi bo'lishi mumkin.
  Qonuniy holatlar: rejalashtirilgan maintenance, bulk configuration deployment.
  SOC triage bosqichlari:
  - O'zgarishlarni amalga oshirgan admin user'ni identifikatsiya qiling
  - Change ticket borligini tekshiring
  - Qanday konfiguratsiyalar o'zgartirilganini aniqlang
  - O'zgarishlar vaqti va tezligini tahlil qiling
  - Kritik security policy o'zgarishlari bo'lganmi tekshiring
type: esql
params: '{}'
schedule_interval: 10m
index:
- logs-fortinet.fortigate-firewall-*
query_language: esql
query: |
  FROM logs-fortinet.fortigate-firewall-*
  | WHERE @timestamp >= NOW() - 45 minutes
  | WHERE message RLIKE "(?i)Configuration is changed in the admin session"
  | WHERE fortinet.fortigate.subtype == "system"
  | WHERE log.level == "alert"
  | STATS
      event_count = COUNT(*),
      users = VALUES(user.name),
      interfaces = VALUES(observer.ingress.interface.name),
      vdoms = VALUES(fortinet.fortigate.vd)
    BY source.ip, bucket = DATE_TRUNC(5 minutes, @timestamp)
  | WHERE event_count >= 18
  | KEEP bucket, source.ip, event_count, users, interfaces, vdoms
  | SORT event_count DESC
  | LIMIT 100
enabled: true
tags:
- attack.defense-evasion
- attack.t1089
- fortigate
- configuration-change
severity: medium
risk_score: 65
references:
- "https://attack.mitre.org/techniques/T1089/"
nist: ["CM-3", "CM-5", "AU-6"]
pci_dss: ["10.2.7"]
gdpr: ["35.7.d"]
mitre_attack:
  TA0005:
    T1089: []