rule_id: c2c39add-cf7d-434c-bfb4-f685e7d97b8b
name: FortiGate - Malware or Virus Detected
description: |
  Ushbu qoida FortiGate Antivirus profili tomonidan aniqlangan va loglarga yozilgan zararli dastur (malware) harakatlarini aniqlaydi.
  Antivirus loglarida virus nomi, fayl nomi va ko'rilgan chora (action) aks etadi. 
  
  SOC triage bosqichlari:
  - 'virus_name' orqali zararli dasturning turini va uning xavflilik darajasini aniqlang.
  - 'action' maydoniga qarang: agar 'blocked' bo'lsa, xavf to'xtatilgan; agar 'monitored' bo'lsa, fayl tarmoqqa kirgan bo'lishi mumkin.
  - Manba IP (`source.ip`) egasini aniqlang va qurilmada to'liq skanerlash o'tkazing.
  - Agar bir xil fayl bir nechta hostda ko'rinsa, bu tarmoq ichida virus tarqalishidan (Outbreak) darak beradi.
type: esql
params: '{}'
schedule_interval: 10m
index:
- logs-fortinet.fortigate-*
query_language: esql
query: |
  FROM logs-fortinet.fortigate-*
  | WHERE @timestamp >= NOW() - 10 minutes
    AND fortinet.fortigate.subtype == "virus"
  | EVAL virus_name = fortinet.fortigate.virus,
         file_name = fortinet.fortigate.filename,
         action = event.action
  | STATS 
      detection_count = COUNT(*),
      last_detected = MAX(@timestamp)
    BY source.ip, destination.ip, virus_name, file_name, action
  | WHERE detection_count > 0
  | SORT last_detected DESC
  | LIMIT 100
enabled: true
tags:
  - attack.malware
  - fortigate.virus
  - detection.threat
severity: critical
risk_score: 95
references:
  - "https://docs.fortinet.com/document/fortigate/7.4.0/fortios-log-message-reference"
nist: ["SI-3", "SI-4"]
pci_dss: ["5.1", "5.2"]
gdpr: ["32.1.b"]
mitre_attack:
  TA0001:
    T1566: []
  TA0002:
    T1204: ["T1204.002"]