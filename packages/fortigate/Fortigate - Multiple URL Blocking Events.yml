rule_id: b52a73e2-7344-4001-a4ca-ef8badfe52ec
name: Fortigate - Multiple URL Blocking Events
description: |
  Ushbu qoida bir xil manbadan ko'p URL blocking hodisalarini aniqlaydi.
  Bu policy bypass urinishi yoki malicious activity belgisi bo'lishi mumkin.
  Qonuniy holatlar: user hatolik, legitimate site false positive.
  SOC triage bosqichlari:
  - Bloklangan URL'larni tahlil qiling
  - URL kategoriyalarini tekshiring
  - User va device identity'ni aniqlang
  - Pattern va frequency'ni tahlil qiling
  - Malicious domain yoki IP reputation tekshiring
type: esql
params: '{}'
schedule_interval: 10m
index:
- fortigate-*
query_language: esql
query: |
  FROM filebeat-fortigate-*
  | WHERE @timestamp >= NOW() - 45 minutes
  | WHERE fortinet.firewall.action == "blocked"
  | WHERE fortinet.firewall.status == "warning"
  | WHERE fortinet.firewall.subtype == "webfilter"
  | STATS
      event_count = COUNT(*),
      hostnames = VALUES(url.domain),
      urls = VALUES(url.path),
      profiles = VALUES(fortinet.firewall.profile),
      categories = VALUES(fortinet.firewall.cat)
    BY source.ip, bucket = DATE_TRUNC(5 minutes, @timestamp)
  | WHERE event_count >= 18
  | KEEP bucket, source.ip, event_count, hostnames, urls, profiles, categories
  | SORT event_count DESC
  | LIMIT 100
enabled: true
tags:
- attack.command-and-control
- fortigate
- web-filter
- policy-violation
severity: medium
risk_score: 55
references:
- "https://attack.mitre.org/tactics/TA0011/"
nist: ["SC-7", "SI-4"]
pci_dss: ["1.4", "10.6.1"]
gdpr: ["35.7.d"]
mitre_attack:
  TA0011: {}