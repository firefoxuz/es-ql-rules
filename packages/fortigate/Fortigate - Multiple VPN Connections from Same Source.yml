rule_id: 7d225589-651d-4cc1-bbec-6a67cb30da54
name: Fortigate - Multiple VPN Connections from Same Source
description: |
  Ushbu qoida bir xil manba IP'dan ko'p VPN tunnel ulanishlarini aniqlaydi.
  Bu credential compromise yoki stolen session belgisi bo'lishi mumkin (T1078).
  Qonuniy holatlar: dynamic IP, shared VPN user, reconnection issues.
  SOC triage bosqichlari:
  - User identity va legitimligini tasdiqlang
  - Manba IP geo-location'ini tekshiring
  - VPN ulanish pattern'ini tahlil qiling
  - Normal VPN usage bilan solishtiring
  - Session duration va data transfer hajmini tekshiring
type: esql
params: '{}'
schedule_interval: 10m
index:
- fortigate-*
query_language: esql
query: |
  FROM filebeat-fortigate-*
  | WHERE @timestamp >= NOW() - 45 minutes
  | WHERE fortinet.firewall.action == "tunnel-up"
  | WHERE fortinet.firewall.subtype == "vpn"
  | WHERE log.level == "information"
  | STATS
      event_count = COUNT(*),
      users = VALUES(user.name),
      groups = VALUES(user.group.name),
      tunnel_ips = VALUES(fortinet.firewall.tunnelip),
      tunnel_types = VALUES(fortinet.firewall.tunneltype)
    BY source.ip, bucket = DATE_TRUNC(10 minutes, @timestamp)
  | WHERE event_count >= 18
  | KEEP bucket, source.ip, event_count, users, groups, tunnel_ips, tunnel_types
  | SORT event_count DESC
  | LIMIT 100
enabled: true
tags:
- attack.initial-access
- attack.t1078
- fortigate
- vpn
- authentication
severity: medium
risk_score: 60
references:
- "https://attack.mitre.org/techniques/T1078/"
nist: ["AC-17", "IA-2"]
pci_dss: ["8.2", "10.2.5"]
gdpr: ["32.2"]
mitre_attack:
  TA0001:
    T1078: []