rule_id: 04887f86-f939-49dd-b1b1-fb2e166877de
name: Tomcat - Anomalous 500 Error Rate Spike (App Crash / DoS Indicator)
description: |
  Ushbu qoida qisqa vaqt ichida katta miqdordagi HTTP 500 xatoliklarini 
  aniqlaydi. Bu DoS hujumi, exploit urinishi yoki ilovaning nosozligi 
  belgisi bo'lishi mumkin (T1499, T1190).
  Qonuniy holatlar: deploy yangilanishi, DB ulanish muammosi, memory pressure.
  SOC triage bosqichlari:
  - Error spike boshlanish vaqtini aniqlang
  - Bir vaqtda deploy bo'lganligini tekshiring
  - Xatoliklar bir nechta hostdan kelayaptimi yoki bittadanmi?
  - DB/backend servis holatini tekshiring
  - Manba IP'lar majmuini tekshiring
type: esql
params: '{}'
schedule_interval: 5m
index:
  - filebeat-tomcat-*
query_language: esql
query: |
  FROM filebeat-tomcat-*
  | WHERE @timestamp >= NOW() - 15 minutes
  | WHERE data_stream.dataset == "tomcat.access"
  | WHERE rsa.misc.result_code LIKE "5*"
  | STATS
      error_count = COUNT(*),
      error_codes = VALUES(rsa.misc.result_code),
      affected_urls = VALUES(rsa.web.urlpage),
      source_ips = VALUES(source.ip),
      unique_ips = COUNT_DISTINCT(source.ip),
      methods = VALUES(rsa.web.p_web_method)
    BY rsa.network.host_dst, bucket = DATE_TRUNC(5 minutes, @timestamp)
  | WHERE error_count >= 50
  | KEEP agent_id, bucket, rsa.network.host_dst, error_count, unique_ips, error_codes, affected_urls, source_ips, methods
  | SORT error_count DESC
  | LIMIT 50
enabled: true
tags:
  - attack.impact
  - attack.t1499
  - attack.initial-access
  - attack.t1190
  - tomcat
  - dos
  - availability
severity: high
risk_score: 70
references:
  - "https://attack.mitre.org/techniques/T1499/"
nist: ["SI-2", "SC-5"]
pci_dss: ["6.5.6", "12.10"]
gdpr: ["32.1"]
mitre_attack:
  TA0040:
    T1499: []