rule_id: b4ffedb8-fb0c-4d67-bbeb-a0874ff23c0c
name: Tomcat - Scanner / Reconnaissance Activity Detected
description: |
  Ushbu qoida bir IP'dan ko'p xil URL path'lariga qilingan so'rovlarni 
  aniqlaydi â€” bu automated scanner (Nikto, Dirbuster, Nuclei) yoki 
  manual reconnaissance belgisi bo'lishi mumkin (T1595, T1046).
  Qonuniy holatlar: pentest, vulnerability scan (authorized).
  SOC triage bosqichlari:
  - User-Agent string'ni tekshiring (scanner signature'mi?)
  - Scan'ning authorized pentest bilan mosligini tasdiqlang
  - Scan qilingan path'larni ro'yxatlang
  - Manba IP'ni threat intel bilan solishtiring
  - Muvaffaqiyatli (200) response'lar borligini tekshiring
type: esql
params: '{}'
schedule_interval: 10m
index:
  - filebeat-tomcat-*
query_language: esql
query: |
  FROM filebeat-tomcat-*
  | WHERE @timestamp >= NOW() - 30 minutes
  | WHERE data_stream.dataset == "tomcat.access"
  | WHERE rsa.misc.client LIKE "*nikto*"
     OR rsa.misc.client LIKE "*dirbuster*"
     OR rsa.misc.client LIKE "*nuclei*"
     OR rsa.misc.client LIKE "*gobuster*"
     OR rsa.misc.client LIKE "*sqlmap*"
     OR rsa.misc.client LIKE "*masscan*"
     OR rsa.misc.client LIKE "*nmap*"
     OR rsa.misc.client LIKE "*ZAP*"
     OR rsa.misc.client LIKE "*acunetix*"
     OR rsa.misc.client LIKE "*burpsuite*"
  | STATS
      scan_count = COUNT(*),
      unique_paths = COUNT_DISTINCT(rsa.web.urlpage),
      paths_sample = VALUES(rsa.web.urlpage),
      scanner_agents = VALUES(rsa.misc.client),
      response_codes = VALUES(rsa.misc.result_code)
    BY source.ip, bucket = DATE_TRUNC(10 minutes, @timestamp)
  | WHERE scan_count >= 10
  | KEEP agent_id, bucket, source.ip, scan_count, unique_paths, paths_sample, scanner_agents, response_codes
  | SORT scan_count DESC
  | LIMIT 50
enabled: true
tags:
  - attack.reconnaissance
  - attack.t1595
  - attack.discovery
  - attack.t1046
  - tomcat
  - scanner
  - recon
severity: medium
risk_score: 55
references:
  - "https://attack.mitre.org/techniques/T1595/"
  - "https://attack.mitre.org/techniques/T1046/"
nist: ["SI-4", "AU-6"]
pci_dss: ["11.3", "10.6"]
gdpr: ["32.1"]
mitre_attack:
  TA0043:
    T1595: []