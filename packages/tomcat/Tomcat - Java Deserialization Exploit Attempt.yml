rule_id: 61c661fa-4499-4feb-bf25-353c56324419
name: Tomcat - Java Deserialization Exploit Attempt
description: |
  Ushbu qoida Tomcat'ning Java deserialization zaifliklarini 
  exploit qilish urinishlarini aniqlaydi (CVE-2017-12617, Apache 
  Commons Collections kabi). Bu remote code execution imkonini beradi (T1190, T1059.007).
  Qonuniy holatlar: Yo'q â€” bu har doim xavfli signal.
  SOC triage bosqichlari:
  - Zudlik bilan manba IP'ni bloklang
  - Tomcat server loglarini tekshiring (exception stack trace bormi?)
  - Serverda yangi process'lar paydo bo'lganini tekshiring
  - Network connection'larni tekshiring (reverse shell urinishi?)
  - Incident Response jarayonini boshlang
type: esql
params: '{}'
schedule_interval: 5m
index:
  - filebeat-tomcat-*
query_language: esql
query: |
  FROM filebeat-tomcat-*
  | WHERE @timestamp >= NOW() - 15 minutes
  | WHERE data_stream.dataset == "tomcat.access"
  | WHERE rsa.web.urlpage LIKE "*.ser*"
     OR rsa.web.urlpage LIKE "*jndi:*"
     OR rsa.web.urlpage LIKE "*${jndi*"
     OR rsa.web.urlpage LIKE "*aced0005*"
     OR rsa.web.urlpage LIKE "*java.io.ObjectInputStream*"
     OR rsa.misc.content_type LIKE "*application/x-java-serialized-object*"
     OR rsa.web.p_url LIKE "*jndi:ldap*"
     OR rsa.web.p_url LIKE "*jndi:rmi*"
  | STATS
      event_count = COUNT(*),
      exploit_urls = VALUES(rsa.web.urlpage),
      response_codes = VALUES(rsa.misc.result_code),
      content_types = VALUES(rsa.misc.content_type),
      methods = VALUES(rsa.web.p_web_method)
    BY source.ip, bucket = DATE_TRUNC(5 minutes, @timestamp)
  | WHERE event_count >= 1
  | KEEP agent_id, bucket, source.ip, event_count, exploit_urls, response_codes, content_types, methods
  | SORT event_count DESC
  | LIMIT 100
enabled: true
tags:
  - attack.initial-access
  - attack.t1190
  - attack.execution
  - attack.t1059.007
  - tomcat
  - deserialization
  - rce
  - log4shell
severity: critical
risk_score: 95
references:
  - "https://attack.mitre.org/techniques/T1190/"
  - "https://attack.mitre.org/techniques/T1059/007/"
  - "https://nvd.nist.gov/vuln/detail/CVE-2021-44228"
nist: ["SI-2", "SI-3", "SC-7"]
pci_dss: ["6.3.1", "6.5.1"]
gdpr: ["32.2"]
mitre_attack:
  TA0001:
    T1190: []
  TA0002:
    T1059: ["T1059.007"]