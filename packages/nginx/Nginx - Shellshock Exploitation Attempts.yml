rule_id: bcc724e1-f79d-4b22-b8d4-299a1d473013
name: Nginx - Shellshock Exploitation Attempts
description: |
  Ushbu qoida Nginx access log'da Shellshock (CVE-2014-6271) exploitation urinishlarini aniqlaydi.
  Bu remote code execution urinishi belgisi (T1190).
  Qonuniy holatlar: security scanning, penetration testing.
  SOC triage bosqichlari:
  - Shellshock payload'ni tahlil qiling
  - User-Agent va Referer header'larni tekshiring
  - Backend CGI scripts va bash usage'ni review qiling
  - System va bash version vulnerability'sini confirm qiling
  - Successful exploitation indicator'lari bormi qidiring
  - Immediate patching zarurligini baholang
type: esql
params: '{}'
schedule_interval: 10m
index:
- filebeat-nginx-*
query_language: esql
query: |
  FROM logs-nginx* 
  | WHERE @timestamp >= NOW() - 45 minutes
  | WHERE data_stream.dataset == "nginx.access"
  | WHERE user_agent.original RLIKE "(?i)(\\(\\).*\\{.*:;.*\\}|\\(\\).*\\{.*:.*\\}.*bash|\\(\\).*\\{.*;.*\\})" OR url.original RLIKE "(?i)(\\(\\).*\\{.*:;.*\\}|\\(\\).*\\{.*:.*\\}.*bash)"
  | STATS
      event_count = COUNT(*),
      user_agents = VALUES(user_agent.original),
      urls = VALUES(url.original),
      methods = VALUES(http.request.method),
      status_codes = VALUES(http.response.status_code)
    BY source.ip, bucket = DATE_TRUNC(5 minutes, @timestamp)
  | WHERE event_count >= 1
  | KEEP agent_id, bucket, source.ip, event_count, user_agents, urls, methods, status_codes
  | SORT event_count DESC
  | LIMIT 100
enabled: true
tags:
- attack.initial-access
- attack.t1190
- nginx
- shellshock
- rce
- cve-2014-6271
severity: critical
risk_score: 95
references:
- "https://attack.mitre.org/techniques/T1190/"
- "https://nvd.nist.gov/vuln/detail/CVE-2014-6271"
nist: ["SI-3", "SI-4"]
pci_dss: ["6.2", "11.4"]
gdpr: ["35.7.d"]
mitre_attack:
  TA0001:
    T1190: []