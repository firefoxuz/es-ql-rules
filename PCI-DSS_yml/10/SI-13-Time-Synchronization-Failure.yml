name: Time Synchronization Failure
description: |
  Detects NTP synchronization failures on systems in CDE.
type: esql
params: '{}'
schedule_interval: 30m
index:
  - filebeat-*
  - metricbeat-*
query_language: esql
query: |
  FROM filebeat-*, metricbeat-*
  | WHERE @timestamp >= NOW() - 30 minutes
  | WHERE (message RLIKE ".*(ntp.*fail|time sync.*error|chronyd.*unreachable).*"
          OR message RLIKE ".*(clock.*skew|time.*offset).*")
    AND host.name RLIKE ".*(cde|payment).*"
  | STATS sync_failures = COUNT(*) BY host.name
  | WHERE sync_failures >= 3
  | EVAL severity = "medium"
  | KEEP @timestamp, host.name, sync_failures, message, severity
enabled: false
tags:
  - system-integrity
severity: medium
risk_score: 50
# MITRE ATT&CK: tactic external_id -> technique external_id -> [subtechnique external_ids]
mitre_attack: {}
nist: ["AU-8"]
gdpr: []
pci-dss: ["10.4.3"]
hipaa: []
