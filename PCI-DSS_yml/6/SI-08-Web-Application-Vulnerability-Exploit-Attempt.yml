name: Web Application Vulnerability Exploit Attempt
description: |
  Detects SQL injection, XSS, and other OWASP Top 10 exploit attempts on payment web apps.
type: esql
params: '{}'
schedule_interval: 10m
index:
  - metricbeat-*
  - filebeat-*
query_language: esql
query: |
  FROM metricbeat-*, filebeat-*
  | WHERE @timestamp >= NOW() - 10 minutes
  | WHERE (http.request.body.content RLIKE ".*(UNION SELECT|'; DROP TABLE|<script>|javascript:|../../../etc/passwd).*"
          OR url.query RLIKE ".*(\\' OR 1=1|<script|\\.\\./).*"
          OR message RLIKE ".*(SQL injection|XSS attempt|directory traversal).*")
    AND (url.path RLIKE ".*(payment|checkout|transaction|admin).*"
         OR host.name RLIKE ".*(payment-web|gateway-app).*")
  | STATS attack_count = COUNT(*) BY source.ip, url.path, host.name
  | WHERE attack_count >= 3
  | EVAL severity = "critical"
  | KEEP @timestamp, source.ip, host.name, url.path, http.request.body.content, attack_count, severity
enabled: false
tags:
  - system-integrity
severity: critical
risk_score: 90
# MITRE ATT&CK: tactic external_id -> technique external_id -> [subtechnique external_ids]
mitre_attack: {}
nist: []
gdpr: []
pci-dss: ["6.4.1"]
hipaa: []
