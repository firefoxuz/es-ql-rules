name: Weak TLS Version Detected (TLS 1.0/1.1)
description: |
  Identifies TLS connections using deprecated versions (TLS 1.0 or 1.1).
type: esql
params: '{}'
schedule_interval: 15m
index:
  - metricbeat-*
query_language: esql
query: |
  FROM metricbeat-*
  | WHERE @timestamp >= NOW() - 15 minutes
  | WHERE tls.version_protocol IN ("tls", "ssl")
    AND tls.version RLIKE ".*(1\\.0|1\\.1|SSLv[23]).*"
    AND destination.port IN (443, 8443, 9443)
  | STATS 
      connection_count = COUNT(*),
      tls_versions = VALUES(tls.version)
    BY source.ip, destination.ip, host.name
  | WHERE connection_count >= 1
  | EVAL severity = "high"
  | KEEP @timestamp, source.ip, destination.ip, tls.version, tls_versions, connection_count, severity
enabled: false
tags:
  - system-communications
severity: high
risk_score: 75
# MITRE ATT&CK: tactic external_id -> technique external_id -> [subtechnique external_ids]
mitre_attack: {}
nist: ["SC-8", "SC-13"]
gdpr: []
pci-dss: ["4.2.1", "1.2"]
hipaa: []
