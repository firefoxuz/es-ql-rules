name: Known Malicious Process Execution
description: |
  Detects execution of processes matching known malware indicators.
type: esql
params: '{}'
schedule_interval: 5m
index:
  - auditbeat-*
  - winlogbeat-*
query_language: esql
query: |
  FROM auditbeat-*, winlogbeat-*
  | WHERE @timestamp >= NOW() - 5 minutes
  | WHERE process.name IN ("mimikatz.exe", "psexec.exe", "netcat.exe", "nc.exe", "powershell.exe", "cmd.exe")
    AND (process.args RLIKE ".*(invoke-mimikatz|sekurlsa|dump|lsass).*"
         OR process.args RLIKE ".*(-enc|-e |bypass|hidden).*")
  | WHERE host.name RLIKE ".*(cde|payment|prod).*"
  | EVAL severity = "critical"
  | KEEP @timestamp, host.name, user.name, process.name, process.args, process.executable, severity
enabled: false
tags:
  - system-integrity
severity: critical
risk_score: 90
# MITRE ATT&CK: tactic external_id -> technique external_id -> [subtechnique external_ids]
mitre_attack: {}
nist: ["SI-3"]
gdpr: []
pci-dss: ["5.4.1"]
hipaa: []
