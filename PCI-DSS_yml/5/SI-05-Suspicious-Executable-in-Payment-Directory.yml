name: Suspicious Executable in Payment Directory
description: |
  Detects new executable files in payment application directories.
type: esql
params: '{}'
schedule_interval: 10m
index:
  - auditbeat-*
  - winlogbeat-*
query_language: esql
query: |
  FROM auditbeat-*, winlogbeat-*
  | WHERE @timestamp >= NOW() - 10 minutes
  | WHERE event.action IN ("created", "renamed", "moved")
    AND (file.extension IN ("exe", "dll", "so", "sh", "bat", "ps1", "vbs")
         OR file.path RLIKE ".*\\.(exe|dll|so|sh|bat|ps1)$")
    AND file.path RLIKE ".*(payment|pos|gateway|cardholder).*"
  | WHERE file.path NOT RLIKE ".*(Program Files|application|bin).*"
  | EVAL severity = "high"
  | KEEP @timestamp, host.name, user.name, file.path, file.hash.sha256, event.action, severity
enabled: false
tags:
  - system-integrity
severity: high
risk_score: 75
# MITRE ATT&CK: tactic external_id -> technique external_id -> [subtechnique external_ids]
mitre_attack: {}
nist: []
gdpr: []
pci-dss: ["5.3.1"]
hipaa: []
