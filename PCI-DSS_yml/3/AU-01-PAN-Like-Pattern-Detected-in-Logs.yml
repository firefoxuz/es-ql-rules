name: PAN-Like Pattern Detected in Logs
description: |
  Identifies potential Primary Account Numbers (PAN) in log files or network traffic.
type: esql
params: '{}'
schedule_interval: 10m
index:
  - filebeat-*
  - metricbeat-*
query_language: esql
query: |
  FROM filebeat-*, metricbeat-*
  | WHERE @timestamp >= NOW() - 10 minutes
  | WHERE message RLIKE ".*[0-9]{4}[- ]?[0-9]{4}[- ]?[0-9]{4}[- ]?[0-9]{4}.*"
    OR http.request.body.content RLIKE ".*[0-9]{13,19}.*"
  | WHERE message NOT RLIKE ".*(XXXX|\\*\\*\\*\\*|masked).*"
  | STATS pan_occurrences = COUNT(*) BY host.name, log.file.path
  | WHERE pan_occurrences >= 1
  | EVAL severity = "critical"
  | KEEP @timestamp, host.name, log.file.path, pan_occurrences, severity
enabled: false
tags:
  - audit
severity: critical
risk_score: 90
# MITRE ATT&CK: tactic external_id -> technique external_id -> [subtechnique external_ids]
mitre_attack: {}
nist: []
gdpr: []
pci-dss: ["3.3.1", "3.4.1"]
hipaa: []
