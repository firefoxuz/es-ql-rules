name: Media Destruction Logging Failure
description: |
  Identifies gaps in media destruction logging for devices containing CHD.
type: esql
params: '{}'
schedule_interval: 7d
index:
  - filebeat-*
query_language: esql
query: |
  FROM filebeat-*
  | WHERE @timestamp >= NOW() - 7 days
  | WHERE message RLIKE ".*(media destruction|hard drive|disk shred|degauss).*"
  | STATS 
      destruction_events = COUNT(*),
      last_log = MAX(@timestamp)
    BY host.name
  | WHERE destruction_events < 1
  | EVAL days_since_last = (@timestamp - last_log) / 86400000
  | WHERE days_since_last > 7
  | EVAL severity = "medium"
  | KEEP @timestamp, host.name, destruction_events, last_log, days_since_last, severity
enabled: false
tags:
  - audit
severity: medium
risk_score: 50
# MITRE ATT&CK: tactic external_id -> technique external_id -> [subtechnique external_ids]
mitre_attack: {}
nist: []
gdpr: []
pci-dss: ["9.8.2"]
hipaa: []
