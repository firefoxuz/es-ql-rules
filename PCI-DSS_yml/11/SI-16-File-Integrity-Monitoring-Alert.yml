name: File Integrity Monitoring Alert
description: |
  Detects changes to critical payment application files via FIM.
type: esql
params: '{}'
schedule_interval: 10m
index:
  - auditbeat-*
query_language: esql
query: |
  FROM auditbeat-*
  | WHERE @timestamp >= NOW() - 10 minutes
  | WHERE event.module == "file_integrity"
    AND event.action IN ("updated", "deleted", "attributes_modified")
    AND (file.path RLIKE ".*/opt/payment-app/.*"
         OR file.path RLIKE ".*\\\\PaymentGateway\\\\.*")
  | WHERE file.path NOT RLIKE ".*(log|tmp|cache).*"
  | EVAL severity = "high"
  | KEEP @timestamp, host.name, user.name, file.path, file.hash.sha256, event.action, severity
enabled: false
tags:
  - system-integrity
severity: high
risk_score: 75
# MITRE ATT&CK: tactic external_id -> technique external_id -> [subtechnique external_ids]
mitre_attack: {}
nist: ["SI-7"]
gdpr: []
pci-dss: ["11.5.1"]
hipaa: []
