name: Wireless Access Point Detected in CDE
description: |
  Detects unauthorized wireless access points in cardholder data environment.
type: esql
params: '{}'
schedule_interval: 30m
index:
  - metricbeat-*
  - filebeat-*
query_language: esql
query: |
  FROM metricbeat-*, filebeat-*
  | WHERE @timestamp >= NOW() - 30 minutes
  | WHERE (message RLIKE ".*(SSID|wireless|802\\.11|access point).*"
          OR network.protocol == "ieee80211")
    AND (host.name RLIKE ".*(cde|payment|datacenter).*"
         OR message RLIKE ".*unauthorized.*wireless.*")
  | WHERE message NOT RLIKE ".*(approved-wifi|guest-network|corp-ssid).*"
  | STATS ap_detections = COUNT(*) BY host.name, message
  | WHERE ap_detections >= 1
  | EVAL severity = "critical"
  | KEEP @timestamp, host.name, message, ap_detections, severity
enabled: false
tags:
  - access-control
severity: critical
risk_score: 90
# MITRE ATT&CK: tactic external_id -> technique external_id -> [subtechnique external_ids]
mitre_attack: {}
nist: ["AC-18"]
gdpr: []
pci-dss: ["11.2.1"]
hipaa: []
