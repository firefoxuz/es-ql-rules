rule_id: cb44a85a-8e13-4ecc-9aca-bb64c11b6754
#//RULE-GDPR-38 â€” SaaS Provider Data Processing in Undisclosed Jurisdictions (GDPR Article 28)
#//Requirement: Article 28
#//Objective: Detect third-party SaaS processing data outside documented regions
#//Data sources: Network flow logs, DNS logs, API logs
#//ECS fields used: event.original, event.original, event.original
#//GDPR field validation: Verify personal data fields exist (user.email, geo.country, etc.)
#//Tuning notes: Maintain approved SaaS provider list; monitor outbound connections
#//NOTE: Requires cloud provider integration (AWS CloudTrail, Azure Activity Log, GCP Audit Log)

name: "SaaS Application Sending Data to Undisclosed Geographic Locations"
description: |
  Identifies Software-as-a-Service applications transmitting personal data to
  geographic locations not disclosed in Data Processing Agreements (DPAs) or processor
  contracts per GDPR Article 28. Detects API calls, file uploads, or data syncs
  to SaaS provider endpoints resolving to IP addresses in undisclosed countries.
  Processor location transparency is critical for transfer compliance and supervisory
  authority oversight. Monitor DNS resolutions and connection patterns for authorized
  SaaS tools and correlate with documented processing locations in contracts.
type: esql
params: '{}'
schedule_interval: 12h
index:
  - filebeat-*
  - winlogbeat-*
  - auditbeat-*
query_language: esql
query: |
  FROM filebeat-*
  | WHERE event.original == "outbound"
    AND (
      event.original RLIKE "(?i).*(salesforce|hubspot|zendesk|intercom|mailchimp|sendgrid|twilio|segment|mixpanel).*"
      OR event.original RLIKE "(?i).*(saas|cloud.*app|platform).*"
    )
    AND event.original IS NOT NULL
  | WHERE NOT event.original IN ("US", "IE", "DE", "GB", "FR", "NL")  // Example: documented DPA locations
  | STATS undisclosed_connections = COUNT(*),
          saas_providers = VALUES(event.original),
          countries = VALUES(event.original),
          data_volume_mb = SUM(event.original) / 1048576
    BY event.original, event.original
  | WHERE undisclosed_connections > 5
  | EVAL risk_score = CASE(
      countries IN ("CN", "RU", "IN"), 100,
      data_volume_mb > 100, 95,
      undisclosed_connections > 50, 90,
      85
    )
  | KEEP agent_id, event.original, event.original, undisclosed_connections, data_volume_mb, countries, risk_score
  | SORT risk_score DESC
enabled: false
tags:
  - gdpr
  - article_28
  - saas
  - data_processor
  - geographic_disclosure
severity: high
risk_score: 90
references:
  - "GDPR Article 28 - Processor Obligations"
  - "GDPR Article 46 - Transfer Safeguards"
nist: ["SC-38"]
gdpr: ["28"]
pci_dss: ["12.8"]
mitre_attack:
  TA0011:
    T1071: ["T1071.001"]