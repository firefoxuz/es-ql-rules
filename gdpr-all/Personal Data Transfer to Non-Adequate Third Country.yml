rule_id: 07304c5d-0e7f-40de-bba1-cb2dcfea8744
#//RULE-GDPR-15 â€” Unauthorized International Data Transfer (GDPR Chapter V)
#//Requirement: Articles 44-50
#//Objective: Detect personal data transfers to non-adequate countries without safeguards
#//Data sources: Network logs, file transfer logs, email logs
#//ECS fields used: event.original, event.original, event.original
#//GDPR field validation: Verify personal data fields exist (user.email, geo.country, etc.)
#//Tuning notes: Maintain list of adequate countries; monitor transfers to restricted jurisdictions
#//NOTE: Requires cloud provider integration (AWS CloudTrail, Azure Activity Log, GCP Audit Log)

name: "Personal Data Transfer to Non-Adequate Third Country"
description: |
  Identifies transfers of personal data to countries without EU adequacy decisions
  or appropriate safeguards (SCCs, BCRs, derogations) as required by GDPR Chapter V.
  Detects large file transfers, database exports, or email attachments sent to IP
  addresses in non-adequate jurisdictions (e.g., Russia, China, most non-EEA countries).
  Unauthorized international transfers violate GDPR Articles 44-46 and risk data
  subject privacy. Verify transfer mechanisms and impact assessments.
type: esql
params: '{}'
schedule_interval: 10m
index:
  - filebeat-*
  - winlogbeat-*
  - auditbeat-*
query_language: esql
query: |
  FROM filebeat-*
  | WHERE event.original == "outbound"
    AND event.original IS NOT NULL
    AND event.original > 1048576  
    AND NOT CIDR_MATCH(event.original, "10.0.0.0/8", "172.16.0.0/12", "192.168.0.0/16")
  | WHERE event.original NOT IN ("AT", "BE", "BG", "HR", "CY", "CZ", "DK", "EE", "FI", "FR", "DE", "GR", "HU", "IE", "IT", "LV", "LT", "LU", "MT", "NL", "PL", "PT", "RO", "SK", "SI", "ES", "SE", "GB", "NO", "IS", "LI", "CH", "IL", "JP", "NZ", "CA", "KR", "AR", "UY")  // EEA + adequate countries
  | STATS transfer_count = COUNT(*),
          total_mb = SUM(event.original) / 1048576,
          countries = VALUES(event.original),
          destinations = VALUES(event.original),
          users = VALUES(user.name)
    BY event.original, user.name
  | WHERE transfer_count > 0
  | EVAL risk_score = CASE(
      countries IN ("CN", "RU", "IR", "KP"), 100,  
      total_mb > 1000, 95,
      transfer_count > 10, 90,
      85
    )
  | KEEP agent_id, event.original, user.name, transfer_count, total_mb, destinations, risk_score
  | SORT risk_score DESC
enabled: false
tags:
  - gdpr
  - chapter_v
  - international_transfer
  - data_protection
  - cross_border
severity: critical
risk_score: 95
references:
  - "GDPR Article 44 - General Principle for Transfers"
  - "GDPR Article 45 - Adequacy Decisions"
  - "GDPR Article 46 - Appropriate Safeguards"
nist: ["AC-20"]
gdpr: ["44-46"]
pci_dss: []
mitre_attack:
  TA0010: 
    T1041: []
