rule_id: 9e1bc417-195c-4620-8886-df64e0e9ffeb
#//RULE-GDPR-05 â€” Special Category Data Processing Without Safeguards (GDPR Article 9)
#//Requirement: Article 9
#//Objective: Detect processing of sensitive data without explicit consent or legal basis
#//Data sources: Application logs, database logs, web access logs
#//ECS fields used: event.category, event.original, event.original, event.original
#//GDPR field validation: Verify personal data fields exist (user.email, geo.country, etc.)
#//Tuning notes: Monitor for health, biometric, genetic data; require explicit consent
#//NOTE: Requires data classification taxonomy (define which fields contain special category personal data)

name: "Special Category Personal Data Processed Without Safeguards"
description: |
  Identifies processing of special categories of personal data (health, biometric,
  genetic, racial/ethnic origin, political opinions, religious beliefs, sexual
  orientation) without explicit consent or Article 9(2) exemptions. GDPR Article 9
  imposes stricter conditions on sensitive data. Detects forms collecting special
  category data, database operations on health/biometric fields, and API calls
  processing sensitive attributes. Requires explicit consent logging and DPIA.
type: esql
params: '{}'
schedule_interval: 10m
index:
  - filebeat-nginx-access-*
query_language: esql
query: |
  FROM filebeat-nginx-access-*
  | WHERE (
      (event.category == "web"
       AND (event.original RLIKE "(?i).*(health|medical|disease|diagnosis|prescription|biometric|fingerprint|face.*scan|genetic|dna|race|ethnicity|religion|political.*party|sexual.*orientation|gender.*identity).*"
            OR event.original RLIKE "(?i).*(health|biometric|genetic|religion|political).*"))
      OR
      (event.category == "database"
       AND event.original RLIKE "(?i).*(health|medical|biometric|genetic|race|religion|political|sexual).*")
    )
  | WHERE NOT (
      event.original RLIKE "(?i).*(explicit.*consent|article.*9.*exemption|healthcare.*provider|legal.*obligation).*"
      OR event.original RLIKE "(?i).*(hospital|clinic|health.*portal|government).*"
    )
  | STATS processing_events = COUNT(*),
          data_categories = VALUES(event.original),
          sources = VALUES(source.ip),
          users = VALUES(user.name)
    BY event.original, host.name
  | WHERE processing_events > 0
  | EVAL risk_score = CASE(
      data_categories RLIKE "(?i).*(biometric|genetic|health).*", 100,
      processing_events > 5, 95,
      90
    )
  | KEEP agent_id, event.original, host.name, processing_events, data_categories, sources, risk_score
  | SORT risk_score DESC
enabled: false
tags:
  - gdpr
  - article_9
  - special_category_data
  - sensitive_data
  - consent
severity: critical
risk_score: 100
references:
  - "GDPR Article 9 - Processing of Special Categories of Personal Data"
  - "GDPR Recital 51 - Sensitive Data"
nist: ["IP-3"]
gdpr: ["9"]
pci_dss: []
mitre_attack:
  T0009:
    T1005: []
