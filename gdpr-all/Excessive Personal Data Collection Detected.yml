rule_id: f36c9377-1eb8-43d3-bc04-3dd7322df1c2
#//RULE-GDPR-01 â€” Excessive Personal Data Collection (GDPR Article 5(1)(c) - Data Minimization)
#//Objective: Detect collection of personal data beyond stated purpose
#//Data sources: Application logs, database logs, web access logs
#//ECS fields used: event.category, event.original, event.original, event.original
#//GDPR field validation: Verify personal data fields exist (user.email, geo.country, etc.)
#//Tuning notes: Define minimal dataset per purpose; monitor over-collection patterns
#//NOTE: Requires data classification taxonomy (define which fields contain special category personal data)

name: "Excessive Personal Data Collection Detected"
description: |
  Identifies collection of personal data fields that exceed the minimum necessary
  for the stated processing purpose, violating GDPR Article 5(1)(c) data minimization
  principle. Detects forms requesting unnecessary sensitive data (race, health,
  biometrics) or excessive contact information. Monitor POST requests and database
  inserts for data elements not justified by legitimate purpose. Correlate with
  privacy impact assessments and data processing records.
type: esql
params: '{}'
schedule_interval: 15m
index:
  - filebeat-nginx-access-*
query_language: esql
query: |
  FROM filebeat-nginx-access-*
  | WHERE event.category == "web"
    AND event.action == "POST"
    AND (
      event.original RLIKE "(?i).*(ssn|social.*security|passport|national.*id|tax.*id|religion|political.*view|sexual.*orientation|biometric|dna|genetic|medical.*record|health.*insurance|race|ethnic).*"
      OR
      (event.category == "database"
       AND event.original RLIKE "(?i).*INSERT.*INTO.*(customer|user|contact).*"
       AND event.original RLIKE "(?i).*(ssn|passport|religion|health|biometric).*")
    )
  | WHERE NOT event.original RLIKE "(?i).*(healthcare|hospital|medical|insurance|government).*"  // Exclude legitimate contexts
  | STATS collection_events = COUNT(*),
          urls = VALUES(event.original),
          data_types = VALUES(event.original),
          sources = VALUES(source.ip)
    BY event.original, host.name
  | WHERE collection_events > 0
  | EVAL risk_score = CASE(
      data_types RLIKE "(?i).*(biometric|genetic|health).*", 100,
      data_types RLIKE "(?i).*(ssn|passport).*", 95,
      collection_events > 10, 85,
      75
    )
  | KEEP agent_id, event.original, host.name, collection_events, data_types, sources, risk_score
  | SORT risk_score DESC
enabled: false
tags:
  - gdpr
  - article_5
  - data_minimization
  - privacy
  - personal_data
severity: high
risk_score: 85
references:
  - "GDPR Article 5(1)(c) - Data Minimisation"
  - "GDPR Article 25 - Data Protection by Design"
nist: ["IP-1"]
gdpr: ["5.1.c"]
pci_dss: []
mitre_attack:
  TA0009:
    T1213: []