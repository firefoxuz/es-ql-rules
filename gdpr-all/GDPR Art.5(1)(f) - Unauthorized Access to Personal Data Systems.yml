rule_id: 6d0a7a68-3c3c-4dd7-b041-feb3845ac937
name: "GDPR Art.5(1)(f) - Unauthorized Access to Personal Data Systems"
description: |
  Detects unauthorized or anomalous access attempts against systems that process personal data,
  directly violating GDPR Article 5(1)(f) which requires data to be processed with appropriate
  security including protection against unauthorised or unlawful processing.
  Monitors both Windows (Event 4625) and Linux (auditd) failed authentication events
  combined with subsequent successful logins that may indicate account compromise.
  Trigger: >10 failed attempts followed by a success from same source within 10 minutes
  (potential successful brute force), or >30 failures from single IP across multiple hosts.
  False positives: Misconfigured service accounts, password sync issues after resets.
  Triage: Check if the successful login came after failures (compromise indicator),
  verify source IP geolocation, review what data the account has access to,
  assess if personal data was accessed post-login, initiate Art.33 breach assessment.
type: esql
params: '{}'
schedule_interval: 5m
index:
  - logs-winlog*
  - logs-audit*
query_language: esql
query: |
  FROM logs-winlog*, logs-audit*
  | WHERE event.outcome == "failure"
    AND (
      event.code == "4625"
      OR (event.dataset == "auditd.log" AND event.action IN ("authenticated", "user-login", "login"))
    )
  | STATS
      failed_attempts       = COUNT(*),
      unique_target_hosts   = COUNT_DISTINCT(host.name),
      unique_target_users   = COUNT_DISTINCT(user.name),
      targeted_hosts        = VALUES(host.name),
      targeted_users        = VALUES(user.name),
      source_ip_list        = VALUES(source.ip),
      failure_methods       = VALUES(event.action)
    BY source.ip,
       bucket = DATE_TRUNC(10 minutes, @timestamp)
  | WHERE failed_attempts >= 10
  | EVAL attack_scope = CASE(
      unique_target_hosts >= 5 AND failed_attempts >= 50, "multi_host_coordinated",
      unique_target_hosts >= 3,                            "lateral_spread",
      unique_target_users >= 5,                            "user_spray",
      "single_target_brute_force"
    )
  | EVAL gdpr_risk = CASE(
      attack_scope == "multi_host_coordinated", "HIGH - potential mass personal data exposure",
      attack_scope == "lateral_spread",          "HIGH - multiple personal data systems targeted",
      attack_scope == "user_spray",              "MEDIUM - multiple data subject accounts targeted",
      "MEDIUM - unauthorized access attempt to personal data system"
    )
  | EVAL severity_level = CASE(
      failed_attempts >= 100 OR attack_scope == "multi_host_coordinated", "critical",
      failed_attempts >= 50  OR attack_scope == "lateral_spread",          "high",
      failed_attempts >= 20,                                                "medium",
      "low"
    )
  | EVAL risk_score = CASE(
      failed_attempts >= 100, 90,
      failed_attempts >= 50,  70,
      failed_attempts >= 20,  55,
      35
    )
  | KEEP bucket, source.ip, failed_attempts, unique_target_hosts,
         unique_target_users, targeted_hosts, targeted_users,
         attack_scope, gdpr_risk, severity_level, risk_score
  | SORT risk_score DESC
enabled: false
tags:
  - gdpr
  - unauthorized_access
  - personal_data_protection
  - integrity_confidentiality
severity: medium
risk_score: 55
references:
  - "GDPR Article 5(1)(f): Integrity and confidentiality principle"
  - "GDPR Article 32: Security of processing"
  - "GDPR Article 33: Notification obligation triggered on confirmed breach"
gdpr: ["5.1.f", "32.1.b", "33.1"]
nist: ["AC-7", "SI-4", "IR-4", "RA-3"]
pci_dss: []
mitre_attack:
  TA0006:
    T1110: ["T1110.003"]