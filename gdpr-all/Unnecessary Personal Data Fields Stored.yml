rule_id: 8e50a310-b69c-4890-95eb-8ba1b507fd47
#//RULE-GDPR-20 â€” Data Minimization Violation - Retention of Unnecessary Data (GDPR Article 5(1)(c))
#//Requirement: Article 5
#//Objective: Detect storage of data not necessary for processing purpose
#//Data sources: Database logs, file system monitoring
#//ECS fields used: event.original, file.path, event.action
#//GDPR field validation: Verify personal data fields exist (user.email, geo.country, etc.)
#//Tuning notes: Define minimal datasets; monitor for bloat/scope creep
#//NOTE: Requires data classification taxonomy (define which fields contain special category personal data)

name: "Unnecessary Personal Data Fields Stored"
description: |
  Identifies database schemas or file structures storing personal data fields that
  are not necessary for the documented processing purpose, violating GDPR Article
  5(1)(c) data minimization. Detects tables with excessive columns (50+ fields),
  collection of "nice-to-have" demographics, or retention of expired marketing
  preferences. Data minimization reduces breach impact and privacy risk. Review
  schemas against purpose specifications and DPIAs.
type: esql
params: '{}'
schedule_interval: 24h
index:
query_language: esql
query: |
  FROM   | WHERE event.category == "database"
    AND event.original RLIKE "(?i).*CREATE.*TABLE.*"
  | EVAL column_count = LENGTH(event.original) - LENGTH(REPLACE(event.original, ",", "")) + 1
  | WHERE column_count > 30  // Tables with >30 columns (customize threshold)
    AND event.original RLIKE "(?i).*(customer|user|contact|personal).*"
  | STATS excessive_schemas = COUNT(*),
          tables = VALUES(event.original),
          column_counts = VALUES(column_count)
    BY event.original, host.name
  | WHERE excessive_schemas > 0
  | EVAL risk_score = CASE(
      column_count > 50, 85,
      column_count > 40, 75,
      65
    )
  | KEEP agent_id, event.original, host.name, excessive_schemas, tables, column_counts, risk_score
  | SORT column_count DESC
enabled: false
tags:
  - gdpr
  - article_5
  - data_minimization
  - database
  - privacy_by_design
severity: medium
risk_score: 70
references:
  - "GDPR Article 5(1)(c) - Data Minimisation"
  - "GDPR Article 25 - Data Protection by Design"
nist: ["IP-1"]
gdpr: ["5.1.c"]
pci_dss: ["3.1"]
mitre_attack: []