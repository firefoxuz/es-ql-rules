rule_id: f831f7cc-a2f3-4035-a970-e0b1ed04dafe
#//RULE-GDPR-36 â€” Personal Data in Non-EU Cloud Region Without SCCs (GDPR Article 46)
#//Requirement: Article 46
#//Objective: Detect cloud deployments outside EU without transfer safeguards
#//Data sources: Cloud provider API logs, infrastructure deployment logs
#//ECS fields used: event.original  # FIXME: cloud.region not available, event.action, event.original
#//GDPR field validation: Verify personal data fields exist (user.email, geo.country, etc.)
#//Tuning notes: Monitor cloud resource creation; verify SCC/BCR coverage
#//NOTE: Requires cloud provider integration (AWS CloudTrail, Azure Activity Log, GCP Audit Log)

name: "Cloud Resource Deployed in Non-EU Region Without Standard Contractual Clauses"
description: |
  Identifies cloud infrastructure resources (VMs, databases, storage buckets)
  deployed in non-EU/EEA regions without documented Standard Contractual Clauses
  (SCCs), Binding Corporate Rules (BCRs), or other Article 46 safeguards. Detects
  AWS/Azure/GCP resource creation in US, Asia-Pacific, or other third-country
  regions processing EU personal data. Post-Schrems II, cloud deployments require
  transfer mechanisms and supplementary measures assessment. Monitor IaC deployments
  and cloud API calls for region parameters.
type: esql
params: '{}'
schedule_interval: 1h
index:
  - filebeat-*
  - winlogbeat-*
  - auditbeat-*
query_language: esql
query: |
  FROM filebeat-*
  | WHERE event.action RLIKE "(?i).*(create|deploy|provision|launch).*"
    AND event.original RLIKE "(?i).*(vm|instance|database|bucket|storage|container).*"
    AND event.original  # FIXME: cloud.region not available NOT IN ("eu-west-1", "eu-west-2", "eu-west-3", "eu-central-1", "eu-north-1", "europe-west1", "europe-west2", "europe-west3", "europe-west4", "europe-north1", "northeurope", "westeurope", "germanywestcentral", "francecentral", "uksouth", "ukwest", "switzerlandnorth")  // EU regions
  | WHERE NOT event.original RLIKE "(?i).*(scc|standard.*contractual.*clauses|bcr|binding.*corporate.*rules|adequacy.*decision|article.*46).*"
  | STATS non_eu_deployments = COUNT(*),
          regions = VALUES(event.original  # FIXME: cloud.region not available),
          resources = VALUES(event.original),
          deployers = VALUES(user.name)
    BY event.original  # FIXME: cloud.region not available, host.name
  | WHERE non_eu_deployments > 0
  | EVAL risk_score = CASE(
      regions IN ("us-east-1", "us-west-2", "ap-southeast-1", "cn-north-1"), 100,  // High-risk regions
      non_eu_deployments > 5, 95,
      90
    )
  | KEEP agent_id, event.original  # FIXME: cloud.region not available, host.name, non_eu_deployments, regions, resources, deployers, risk_score
  | SORT risk_score DESC
enabled: false
tags:
  - gdpr
  - article_46
  - cloud
  - international_transfer
  - sccs
severity: critical
risk_score: 95
references:
  - "GDPR Article 46 - Transfers with Appropriate Safeguards"
  - "GDPR Article 45 - Adequacy Decisions"
  - "EU Commission SCCs 2021"
nist: ["AC-20"]
gdpr: ["46"]
pci_dss: []
mitre_attack:
  TA0042:
    T1583.006: []