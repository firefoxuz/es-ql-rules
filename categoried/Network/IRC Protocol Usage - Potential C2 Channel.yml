rule_id: f4636e04-5f84-44e4-a031-83340459ecfd
name: "IRC Protocol Usage - Potential C2 Channel"
description: |
  This rule detects IRC (Internet Relay Chat) protocol usage by identifying connections to common IRC ports (6667, 6668, 6669, 7000) or IRC-related keywords in event logs. IRC is rarely used in enterprise environments and may indicate malware C2 communication.
  
#  IRC-based C2 channels are common in legacy and current malware families. Detecting IRC usage helps identify compromised hosts.
#  
#  False positives may occur in environments where IRC is legitimately used for internal chat or support. Document legitimate IRC usage and whitelist.
#  
#  Triage steps: (1) Identify the destination server and port, (2) Determine which process initiated the IRC connection, (3) Check destination IP/domain reputation, (4) Isolate the host and perform malware analysis.
type: esql
params: '{}'
schedule_interval: 10m
index:
  - auditbeat-*
  - metricbeat-*
query_language: esql
query: |
  FROM auditbeat-*, metricbeat-*
  | WHERE @timestamp >= NOW() - 15 minutes
  | EVAL hostn = COALESCE(host.name, winlog.computer_name)
  | EVAL srcip = COALESCE(source.ip, winlog.event_data.IpAddress)
  | EVAL dstport = COALESCE(source.port, winlog.event_data.IpPort)
  // Focus on network connections
  | WHERE event.category == "network" OR event.type == "connection"
  // Look for IRC ports or IRC keywords
  | WHERE dstport IN ("6667", "6668", "6669", "7000", "194","4444","8888","9999","1111")
         OR event.original RLIKE "(?i)(irc|port\\s+(6667|6668|6669|7000)|privmsg|join\\s+#|nick\\s+)"
  | STATS 
      connection_count = COUNT(*),
      sample_events = VALUES(SUBSTRING(event.original, 0, 160))
    BY hostn, srcip
  | WHERE connection_count >= 1
  | EVAL risk_score = CASE(
      connection_count >= 5, 90,
      connection_count >= 3, 80,
      75
    )
  | SORT risk_score DESC
  | LIMIT 100
enabled: false
tags:
  - IRC
  - C2 Communication
  - Command and Control
  - Network
severity: high
risk_score: 80
references:
  - "https://attack.mitre.org/techniques/T1071/001/"
nist: ["AU-6", "IR-4", "SI-4"]
gdpr: ["Article 32"]
pci_dss: ["1.3"]
mitre_attack:
  TA0011:
    T1071: ["T1071.001"]