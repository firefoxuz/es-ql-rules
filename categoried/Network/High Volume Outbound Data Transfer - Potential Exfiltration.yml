rule_id: 8fa6e3e1-2d37-4edd-a324-ae94415b9930
name: "High Volume Outbound Data Transfer - Potential Exfiltration"
description: |
  This rule detects unusually high outbound data volumes from a single host within a short time window, which may indicate data exfiltration. While exact byte counts may not be available, high connection counts or repeated large transfers can serve as heuristics.
  
#  Data exfiltration is often characterized by abnormal outbound traffic patterns. Monitoring connection volumes helps detect theft before data leaves the network.
#  
#  False positives may occur with backup systems, cloud sync, or legitimate file transfers. Baseline normal outbound traffic per host and focus on unexpected spikes.
#  
#  Triage steps: (1) Identify the source host and process, (2) Review destination IPs and domains, (3) Check if the transfer is part of scheduled backup or sync, (4) Capture network traffic for forensic analysis.
type: esql
params: '{}'
schedule_interval: 15m
index:
  - auditbeat-*
  - metricbeat-*
query_language: esql
query: |
  FROM auditbeat-*, metricbeat-*
  | WHERE @timestamp >= NOW() - 20 minutes
  | EVAL hostn = COALESCE(host.name, winlog.computer_name)
  | EVAL srcip = COALESCE(source.ip, winlog.event_data.IpAddress)
  // Focus on outbound network connections
  | WHERE event.category == "network" OR event.type == "connection"
  // Exclude internal destinations (focus on external)
  | WHERE NOT event.original RLIKE "(?i)(10\\.|172\\.(1[6-9]|2[0-9]|3[01])\\.|192\\.168\\.)"
  | STATS 
      connection_count = COUNT(*),
      unique_destinations = COUNT_DISTINCT(event.original),
      sample_events = VALUES(SUBSTRING(event.original, 0, 160))
    BY hostn, srcip
  // Heuristic: high connection count may indicate large data transfers
  | WHERE connection_count >= 100
  | EVAL risk_score = CASE(
      connection_count >= 200, 90,
      connection_count >= 150, 80,
      70
    )
  | SORT risk_score DESC
  | LIMIT 100
enabled: false
tags:
  - Data Exfiltration
  - Outbound Traffic
  - Collection
  - Network
severity: high
risk_score: 78
references:
  - "https://attack.mitre.org/techniques/T1041/"
nist: ["AU-6", "IR-4", "SI-4"]
gdpr: ["Article 32", "Article 33"]
pci_dss: ["10.6"]
mitre_attack:
  TA0010:
    T1041: []