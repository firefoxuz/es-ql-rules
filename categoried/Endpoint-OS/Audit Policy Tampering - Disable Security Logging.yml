rule_id: d56954f6-f0da-4c21-8354-0a9ff01a98c2
name: "Audit Policy Tampering - Disable Security Logging"
description: |
  This rule detects modifications to Windows audit policy settings using auditpol.exe to disable security logging. Adversaries disable audit policies to evade detection and prevent forensic investigation.
  
#  Audit policy tampering is a critical defense evasion technique that blinds security monitoring. Detecting these changes is essential for maintaining visibility.
#  
#  False positives may occur during GPO updates, security hardening, or legitimate policy changes. Correlate with change management.
#  
#  Triage steps: (1) Identify the user modifying audit policies, (2) Review which audit categories were disabled, (3) Verify if changes are documented, (4) Restore audit policies immediately and investigate for compromise.
type: esql
params: '{}'
schedule_interval: 5m
index:
  - winlogbeat-*
  - auditbeat-*
query_language: esql
query: |
  FROM winlogbeat-*, auditbeat-*
  | WHERE @timestamp >= NOW() - 10 minutes
  | EVAL hostn = COALESCE(host.name, winlog.computer_name)
  | EVAL userp = COALESCE(user.name, winlog.event_data.SubjectUserName)
  | EVAL procname = COALESCE(process.name, winlog.event_data.NewProcessName)
  | EVAL cmd = COALESCE(process.command_line, winlog.event_data.CommandLine, event.original)
  // Look for auditpol with disable/clear options
  | WHERE procname RLIKE "(?i)auditpol\\.exe"
         OR cmd RLIKE "(?i)auditpol.*(set.*disable|clear|/remove)"
  | STATS 
      auditpol_count = COUNT(*),
      sample_commands = VALUES(SUBSTRING(cmd, 0, 160))
    BY hostn, userp
  | WHERE auditpol_count >= 1
  | EVAL risk_score = CASE(
      auditpol_count >= 3, 95,
      auditpol_count >= 2, 90,
      85
    )
  | SORT risk_score DESC
  | LIMIT 100
enabled: false
tags:
  - Audit Policy
  - Defense Evasion
  - Security Logging
  - Tampering
severity: critical
risk_score: 92
references:
  - "https://attack.mitre.org/techniques/T1562/002/"
nist: ["AU-1", "AU-12", "AU-13", "AU-14", "AU-16", "AU-2", "AU-3", "AU-6", "AU-7", "SI-4"]
gdpr: ["Article 32"]
pci_dss: ["10.5"]
mitre_attack:
  TA0005:
    T1562: ["T1562.002"]
