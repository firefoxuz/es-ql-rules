rule_id: b58309c2-f6cd-40f1-9b54-14fba17122e2
name: "Cross-Site Scripting (XSS) Probing"
description: |
  This rule detects cross-site scripting (XSS) attack attempts by analyzing HTTP requests for common XSS payloads including <script> tags, JavaScript event handlers (onerror, onload, onclick), and encoded variations. It identifies both reflected and stored XSS probing attempts. The detection triggers when 4+ distinct XSS patterns are observed from a single source IP within 10 minutes.

#**Why it matters:**
#XSS vulnerabilities enable session hijacking, credential theft, and client-side attacks:
#- OWASP Top 10 #3 (Injection) includes XSS as a critical vulnerability class
#- PCI DSS 6.5.7 specifically mandates protection against XSS
#- GDPR Article 32 requires safeguards against attacks that could compromise user sessions#
#**False Positives:**
#- Authorized security scanning and penetration testing activities
#- Web application firewalls testing XSS detection capabilities
#- Developers testing input validation and output encoding controls
#- Code repositories or documentation sites containing XSS examples#
#**Triage Steps:**
#1. Check if source IP belongs to authorized security testing infrastructure
#2. Identify targeted parameters and endpoints to locate vulnerable input fields
#3. Review application response codes and content-type headers for successful injection
#4. Test the application manually to confirm XSS vulnerability existence
#5. Check for evidence of actual exploitation (cookie theft, session hijacking)
#6. Implement input validation and output encoding on vulnerable parameters
type: esql
params: '{}'
schedule_interval: 10m
index:
  - filebeat-nginx-access-*
query_language: esql
query: |
  FROM filebeat-nginx-access-*
  // Time window: last 10 minutes
  | WHERE @timestamp >= NOW() - 10 minutes
  // Extract request data
  | EVAL srcip = COALESCE(source.ip, "")
  | EVAL uri = event.original
  | WHERE srcip IS NOT NULL AND uri IS NOT NULL
  // XSS pattern detection
  | WHERE uri RLIKE ".*(<script|<SCRIPT|onerror=|onload=|onclick=|onmouseover=|onfocus=|javascript:|eval\\(|alert\\(|prompt\\(|confirm\\(|%3Cscript|&lt;script|<img|<svg|<iframe).*"
  // Aggregate by source IP
  | STATS 
      request_count = COUNT(*),
      unique_patterns = COUNT_DISTINCT(SUBSTRING(uri, 0, 160)),
      sample_requests = VALUES(SUBSTRING(uri, 0, 160))
    BY srcip
  // Threshold: 4+ distinct XSS patterns
  | WHERE unique_patterns >= 4
  // Risk scoring
  | EVAL risk_score = CASE(
      request_count >= 30, 85,
      request_count >= 15, 75,
      65
    )
  | KEEP srcip, request_count, unique_patterns, risk_score, sample_requests
enabled: false
tags:
  - Web Security
  - XSS
  - OWASP
  - Injection Attack
severity: medium
risk_score: 70
references:
  - "https://owasp.org/www-community/attacks/xss/"
  - "https://attack.mitre.org/techniques/T1059/"
nist: ["SI-10", "SI-4"]
gdpr: ["Article 32"]
pci_dss: ["6.5.7", "11.4"]
mitre_attack:
  TA0001:
    T1190: []