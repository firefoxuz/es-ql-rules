rule_id: 58e3d67f-31b3-4f44-8409-aee307ec39d9

name: "Sensitive File Access Attempts - Configuration and Backup Files"
description: |
  This rule detects attempts to access sensitive files commonly targeted by attackers, including configuration files (.env, .config, web.config), backup files (.bak, .old, backup.zip), version control directories (.git, .svn), and database dumps. These files often contain credentials, API keys, or sensitive data.
  
#  Sensitive file access attempts are strong indicators of reconnaissance or data theft. Attackers probe for these files to extract credentials or sensitive information for further exploitation.
#  
#  False positives may occur with legitimate administrators, monitoring tools, or development activities. Focus on external source IPs and unexpected access patterns.
#  
#  Triage steps: (1) Identify the source IP and requested file paths, (2) Check if the files exist on the server, (3) Verify if access was successful (200 response), (4) Review file contents for exposed secrets and rotate credentials immediately.
type: esql
params: '{}'
schedule_interval: 10m
index:
  - filebeat-nginx-access-*
  - filebeat-nginx-error-*
query_language: esql
query: |
  FROM filebeat-nginx-access-*, filebeat-nginx-error-*
  | WHERE @timestamp >= NOW() - 15 minutes
  | EVAL hostn = COALESCE(host.name, winlog.computer_name)
  | EVAL srcip = COALESCE(source.ip, winlog.event_data.IpAddress)
  // Look for sensitive file patterns in request paths
  | WHERE event.original RLIKE "(?i)(\\.env|\\.config|web\\.config|\\.bak|\\.old|\\.backup|backup\\.zip|\\.git/|\\.svn/|\\.sql|\\.dump|config\\.php|config\\.json|settings\\.xml)"
  | STATS 
      access_count = COUNT(*),
      unique_files = COUNT_DISTINCT(SUBSTRING(event.original, 0, 100)),
      sample_requests = VALUES(SUBSTRING(event.original, 0, 160))
    BY srcip, hostn
  | WHERE access_count >= 3
  | EVAL risk_score = CASE(
      access_count >= 10, 90,
      access_count >= 5, 80,
      70
    )
  | SORT risk_score DESC
  | LIMIT 100
enabled: false
tags:
  - Sensitive Files
  - Configuration Files
  - Reconnaissance
  - Data Exposure
severity: high
risk_score: 82
references:
  - "https://attack.mitre.org/techniques/T1552/001/"
  - "https://owasp.org/www-project-web-security-testing-guide/latest/4-Web_Application_Security_Testing/02-Configuration_and_Deployment_Management_Testing/04-Review_Old_Backup_and_Unreferenced_Files_for_Sensitive_Information"
nist: ["AC-4", "AC-5", "AC-6", "AU-13", "PE-19", "PS-6", "SC-7", "SI-4"]
gdpr: ["Article 32", "Article 33"]
pci_dss: ["6.5"]
mitre_attack:
  TA0007:
    T1552: ["T1552.001"]