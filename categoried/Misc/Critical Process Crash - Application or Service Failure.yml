rule_id: d4dfc033-a9c4-411e-80ad-9a5dfe71e272
name: "Critical Process Crash - Application or Service Failure"
description: |
  This rule detects crashes of critical system processes or services by identifying keywords indicating process termination, application crashes, or service failures in event logs. Frequent crashes may indicate exploitation attempts, malware activity, or system instability.
  
#  Critical process crashes can result from successful exploitation, malware execution, or denial of service attacks. Monitoring crash patterns helps detect attacks and system issues.
#  
#  False positives may occur with legitimate application bugs, resource exhaustion, or hardware failures. Focus on repeated crashes of the same process or crashes following suspicious activity.
#  
#  Triage steps: (1) Identify which process crashed and the crash reason, (2) Review crash dumps or error logs for root cause, (3) Check for exploitation attempts preceding the crash, (4) Patch vulnerable software or investigate for malware.
type: esql
params: '{}'
schedule_interval: 10m
index:
  - winlogbeat-*
  - auditbeat-*
query_language: esql
query: |
  FROM winlogbeat-*, auditbeat-*
  | WHERE @timestamp >= NOW() - 15 minutes
  | EVAL hostn = COALESCE(host.name, winlog.computer_name)
  | EVAL procname = COALESCE(process.name, winlog.event_data.NewProcessName)
  // Look for process crash indicators in event logs
  | WHERE event.original RLIKE "(?i)(application.*crash|process.*terminated|exception.*fault|access.*violation|segmentation.*fault|application.*error|stopped.*working|failed.*start)"
         OR winlog.event_id IN ("1000", "1001", "1002")  // Application error events
  | STATS 
      crash_count = COUNT(*),
      unique_processes = COUNT_DISTINCT(procname),
      sample_crashes = VALUES(SUBSTRING(event.original, 0, 160))
    BY hostn, procname
  // Threshold: 3+ crashes of same process
  | WHERE crash_count >= 3
  | EVAL risk_score = CASE(
      crash_count >= 10, 85,
      crash_count >= 5, 75,
      65
    )
  | SORT risk_score DESC
  | LIMIT 100
enabled: false
tags:
  - Process Crash
  - Application Error
  - DoS
  - Exploitation
severity: medium
risk_score: 70
references:
  - "https://attack.mitre.org/techniques/T1499/"
nist: ["AU-6", "IR-4", "SI-4"]
gdpr: ["Article 32"]
pci_dss: ["10.6"]
mitre_attack:
  TA0040:
    T1499: []