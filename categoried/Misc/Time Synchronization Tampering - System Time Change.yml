rule_id: a8c70af1-3e71-4eaf-8f23-b87a1197ddfb
name: "Time Synchronization Tampering - System Time Change"
description: |
  This rule detects modifications to system time settings which can be used to evade time-based security controls, manipulate log timestamps, or bypass certificate validation. Adversaries may change system time to interfere with forensic analysis or security mechanisms.
  
#  Time tampering is a defense evasion technique that can undermine logging, authentication, and forensic investigations. Monitoring time changes helps maintain temporal integrity.
#  
#  False positives may occur with legitimate time synchronization, daylight saving time changes, or administrator actions. Focus on unexpected changes or changes by non-administrative users.
#  
#  Triage steps: (1) Identify who changed the system time and by how much, (2) Verify if the change is documented or part of maintenance, (3) Check for other suspicious activity around the time change, (4) Restore correct time and investigate for malicious intent.
type: esql
params: '{}'
schedule_interval: 10m
index:
  - winlogbeat-*
  - auditbeat-*
query_language: esql
query: |
  FROM winlogbeat-*, auditbeat-*
  | WHERE @timestamp >= NOW() - 15 minutes
  | EVAL hostn = COALESCE(host.name, winlog.computer_name)
  | EVAL userp = COALESCE(user.name, winlog.event_data.SubjectUserName)
  | EVAL cmd = COALESCE(process.command_line, winlog.event_data.CommandLine, event.original)
  // Look for time change events: Windows Event ID 4616 or time-setting commands
  | WHERE winlog.event_id == "4616"
         OR cmd RLIKE "(?i)(w32tm|net\\s+time|date\\s+/t|Set-Date|timedatectl|hwclock)"
  | STATS 
      time_change_count = COUNT(*),
      sample_events = VALUES(SUBSTRING(event.original, 0, 160))
    BY hostn, userp
  | WHERE time_change_count >= 1
  | EVAL risk_score = CASE(
      time_change_count >= 3, 85,
      time_change_count >= 2, 75,
      70
    )
  | SORT risk_score DESC
  | LIMIT 100
enabled: false
tags:
  - Time Tampering
  - Defense Evasion
  - System Time
  - Forensics
severity: medium
risk_score: 72
references:
  - "https://attack.mitre.org/techniques/T1099/"
nist: ["AU-1", "AU-12", "AU-13", "AU-14", "AU-16", "AU-2", "AU-3", "AU-6", "AU-7", "SI-4"]
gdpr: ["Article 32"]
pci_dss: ["10.4"]
mitre_attack:
  TA0005:
    T1099: []