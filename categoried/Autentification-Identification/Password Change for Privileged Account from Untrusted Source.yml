rule_id: a7e3d4a1-876b-420a-890a-73dcc5db631d

name: "Password Change for Privileged Account from Untrusted Source"
description: |
  This rule detects password changes (Event ID 4724) for privileged accounts (admin, domain admin) initiated from unexpected or untrusted sources. Adversaries may change passwords to maintain persistence or lock out legitimate administrators.
  
#  Unauthorized password changes for privileged accounts are critical security events that can indicate account takeover or insider threat.
#  
#  False positives may occur during legitimate administrative password resets or helpdesk operations. Verify the source host and user initiating the change.
#  
#  Triage steps: (1) Identify who initiated the password change, (2) Verify if the source host is an authorized administrative workstation, (3) Contact the account owner to confirm legitimacy, (4) Force additional password reset if unauthorized.
type: esql
params: '{}'
schedule_interval: 10m
index:
  - winlogbeat-*
query_language: esql
query: |
  FROM winlogbeat-*
  | WHERE @timestamp >= NOW() - 15 minutes
  | EVAL hostn = COALESCE(host.name, winlog.computer_name)
  | EVAL userp = COALESCE(user.name, winlog.event_data.SubjectUserName)
  | EVAL usert = COALESCE(user.target.name, winlog.event_data.TargetUserName)
  // Event ID 4724 = password reset attempt
  | WHERE winlog.event_id == "4724"
  // Heuristic: privileged account naming patterns
  | WHERE usert RLIKE "(?i)(admin|root|administrator|domain.*admin|da-|adm-|enterprise.*admin)"
  | STATS 
      pw_change_count = COUNT(*),
      initiators = VALUES(userp),
      sample_events = VALUES(SUBSTRING(event.original, 0, 160))
    BY hostn, usert
  | WHERE pw_change_count >= 1
  | EVAL risk_score = CASE(
      pw_change_count >= 3, 90,
      pw_change_count >= 2, 80,
      75
    )
  | SORT risk_score DESC
  | LIMIT 100
enabled: false
tags:
  - Password Change
  - Privileged Account
  - Persistence
  - Credential Access
severity: high
risk_score: 80
references:
  - "https://attack.mitre.org/techniques/T1098/"
nist: ["IA-1", "IA-12", "IA-2", "IA-4", "IA-5", "IA-8", "PE-2", "PS-3", "SI-4"]
gdpr: ["Article 32"]
pci_dss: ["8.2"]
mitre_attack:
  TA0003:
    T1098: ["T1098.001"]