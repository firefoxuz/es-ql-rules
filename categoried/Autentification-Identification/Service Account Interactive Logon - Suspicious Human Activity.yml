rule_id: f181a896-a581-4bd4-bc22-314aa40d7b8b
name: "Service Account Interactive Logon - Suspicious Human Activity"
description: |
  This rule detects service accounts performing interactive logons (LogonType 2 or 10) which is anomalous behavior. Service accounts should only perform batch/network logons; interactive sessions may indicate credential compromise or misuse.
  
#  Service accounts are high-value targets. Interactive logons suggest an attacker has obtained credentials and is using them manually, bypassing normal service automation.
#  
#  False positives may occur if administrators temporarily use service accounts for troubleshooting. Document legitimate use cases and whitelist known scenarios.
#  
#  Triage steps: (1) Verify if the service account is documented, (2) Check if interactive logon is expected, (3) Review the source IP and hostname, (4) Interview system administrators.
type: esql
params: '{}'
schedule_interval: 10m
index:
  - winlogbeat-*
query_language: esql
query: |
  FROM winlogbeat-*
  | WHERE @timestamp >= NOW() - 15 minutes
  | EVAL hostn = COALESCE(host.name, winlog.computer_name)
  | EVAL usert = COALESCE(user.target.name, winlog.event_data.TargetUserName)
  | EVAL srcip = COALESCE(source.ip, winlog.event_data.IpAddress)
  // Event ID 4624 = successful logon
  | WHERE winlog.event_id == "4624"
  // LogonType 2 = interactive, 10 = remote interactive (RDP)
  | WHERE winlog.logon.type IN ("2", "10")
  // Heuristic: service account naming patterns (svc, service, app, sql, etc.)
  | WHERE usert RLIKE "(?i)(svc|service|app|sql|iis|backup|admin|system).*"
  | STATS 
      logon_count = COUNT(*),
      logon_types = VALUES(winlog.logon.type),
      sample_events = VALUES(SUBSTRING(event.original, 0, 160))
    BY hostn, usert, srcip
  // Even one interactive logon for service account is suspicious
  | WHERE logon_count >= 1
  | EVAL risk_score = CASE(
      logon_count >= 3, 90,
      logon_count >= 2, 80,
      70
    )
  | SORT risk_score DESC
  | LIMIT 100
enabled: false
tags:
  - Service Account
  - Interactive Logon
  - Credential Access
  - Privilege Escalation
severity: high
risk_score: 75
references:
  - "https://attack.mitre.org/techniques/T1078/002/"
nist: ["IA-1", "IA-12", "IA-2", "IA-4", "IA-5", "IA-8", "PE-2", "PS-3", "SI-4"]
gdpr: ["Article 32"]
pci_dss: ["8.5"]
mitre_attack:
  TA0004:
    T1078: ["T1078.002"]