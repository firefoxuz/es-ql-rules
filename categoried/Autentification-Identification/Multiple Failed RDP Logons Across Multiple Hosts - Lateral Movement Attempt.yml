rule_id: 12924758-5535-4c8d-aaaa-359aa21cb698
name: "Multiple Failed RDP Logons Across Multiple Hosts - Lateral Movement Attempt"
description: |
  This rule detects multiple failed RDP (Remote Desktop Protocol) logon attempts across different hosts from a single user or source IP, indicating potential lateral movement reconnaissance or credential stuffing. Adversaries often probe multiple systems to find accessible targets.
  
#  Failed RDP attempts across many hosts suggest active lateral movement attempts. Early detection can prevent privilege escalation and data exfiltration.
#  
#  False positives may occur with administrators troubleshooting connectivity issues or automated scripts. Focus on unusual usernames or external source IPs.
#  
#  Triage steps: (1) Identify the source IP and user, (2) Check if RDP access is expected for this user/IP, (3) Review successful RDP sessions from the same source, (4) Block unauthorized sources.
type: esql
params: '{}'
schedule_interval: 10m
index:
  - winlogbeat-*
query_language: esql
query: |
  FROM winlogbeat-*
  | WHERE @timestamp >= NOW() - 15 minutes
  | EVAL hostn = COALESCE(host.name, winlog.computer_name)
  | EVAL usert = COALESCE(user.target.name, winlog.event_data.TargetUserName)
  | EVAL srcip = COALESCE(source.ip, winlog.event_data.IpAddress)
  // Event ID 4625 = failed logon, LogonType 10 = remote interactive (RDP)
  | WHERE winlog.event_id == "4625" AND winlog.logon.type == "10"
  | STATS 
      failed_count = COUNT(*),
      unique_hosts = COUNT_DISTINCT(hostn),
      sample_hosts = VALUES(hostn)
    BY usert, srcip
  // Threshold: failed RDP to 3+ different hosts
  | WHERE unique_hosts >= 3 AND failed_count >= 5
  | EVAL risk_score = CASE(
      unique_hosts >= 5, 90,
      unique_hosts >= 4, 80,
      70
    )
  | SORT risk_score DESC
  | LIMIT 100
enabled: false
tags:
  - RDP
  - Lateral Movement
  - Brute Force
  - Reconnaissance
severity: high
risk_score: 78
references:
  - "https://attack.mitre.org/techniques/T1021/001/"
nist: ["AU-6", "IR-4", "SI-4"]
gdpr: ["Article 32"]
pci_dss: ["10.2"]
mitre_attack:
  TA0008:
    T1021: ["T1021.001"]