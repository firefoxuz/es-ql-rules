rule_id: 0ec0f1ab-bcac-4f3b-a35e-e9a96aad47a0
name: AD User Account Disabled Burst on Domain Controller (4725)
description: |
  Ushbu qoida privilege escalation va defense evasion kontekstida akkauntlarni ommaviy disable qilish urinishlarini aniqlaydi.
  Hujumchi xavfsizlik yoki admin akkauntlarini disable qilib monitoringni susaytirishi, javob choralarini kechiktirishi va AD boshqaruvini qo'lga olishi mumkin.
  Qonuniy holatlar: mass offboarding, reorganizatsiya, skript orqali deprovisioning yoki audit tozalash ishlari.
  SOC triage bosqichlari:
  - `actor` kimligini va qaysi `target_user` lar ta'sirlanganini aniqlang.
  - Change ticket/deployment bilan disable amallarining rejalashtirilganligini tasdiqlang.
  - `src_ip` manzili va hostning admin jump-server ekanini tekshiring.
  - Disable qilingan akkauntlarning guruh a'zoligini (Domain Admins va boshqalar) tekshiring.
  - Noqonuniy bo'lsa o'zgarishni rollback qiling, huquqlarni cheklang va aktorni izolyatsiya qiling.
type: esql
params: '{}'
schedule_interval: 10m
index:
- logs-winlog*
query_language: esql
query: |
  FROM logs-winlog*
  | WHERE @timestamp >= NOW() - 15 minutes
  | WHERE winlog.channel == "Security"
  | EVAL hostn = winlog.computer_name
  | EVAL actor = COALESCE(winlog.event_data.SubjectUserName, winlog.event_data.SubjectUserName)
  | EVAL target_user = COALESCE(winlog.event_data.TargetUserName, winlog.event_data.SamAccountName)
  | EVAL src_ip = COALESCE(winlog.event_data.IpAddress, winlog.event_data.IpAddress)
  | WHERE hostn RLIKE "(?i)(WINDC|ADDC|-DC|DOMAINCONTROLLER)"
  | WHERE event.code == "4725"
  | WHERE actor IS NOT NULL
  | WHERE NOT actor RLIKE ".*\\$$"
  | STATS event_count = COUNT(*), unique_targets = COUNT_DISTINCT(target_user) BY hostn, actor, src_ip
  | WHERE unique_targets >= 2
  | EVAL dyn_risk = CASE(unique_targets >= 10, 90, unique_targets >= 5, 84, 76)
  | KEEP agent_id, hostn, actor, src_ip, event_count, unique_targets, dyn_risk
  | SORT dyn_risk DESC, unique_targets DESC
  | LIMIT 200
enabled: false
tags:
  - AD
  - Account Lifecycle
  - Defense Evasion
severity: high
risk_score: 76
references:
  - "https://attack.mitre.org/techniques/T1489/"
mitre_attack:
  TA0040:
    T1489: []
nist: ["AC-6", "AU-12", "AC-2"]
pci_dss: ["7.1", "7.2", "10.2.2"]
gdpr: ["32.1.a", "32.1.b"]
