#//RULE-HIPAA-16 — Amendment Request Not Processed - §164.526
#//Requirement: HIPAA Privacy Rule §164.526 - Right to Amend
#//Objective: Detect patient requests to amend PHI not acted upon
#//Data sources: EHR amendment logs, patient portal logs
#//ECS fields used: event.action, user.name, @timestamp, log.original
#//Tuning notes: Track amendment workflow; monitor 60-day processing deadline

name: "RULE-HIPAA-16: Patient Amendment Request to PHI Not Processed"
description: |
  Identifies patient requests to amend their Protected Health Information that
  have not been acted upon within HIPAA §164.526 required timeframe (60 days,
  extendable once by 30 days with written notice). Detects pending amendment
  requests in EHR systems, patient-submitted corrections not reviewed, or disputed
  information not addressed. Patients have right to request amendments to inaccurate
  or incomplete PHI. Monitor amendment request queue and ensure timely acceptance,
  denial (with reason), or statement of disagreement appending.
type: esql
params: '{}'
schedule_interval: 24h
index:
  - filebeat-*
query_language: esql
query: |
  FROM filebeat-*
  | WHERE (
      event.action RLIKE "(?i).*(amendment.*request|correction.*request|phi.*amend|record.*correction).*"
      OR log.original RLIKE "(?i).*(164.*526|right.*to.*amend|patient.*dispute).*"
    )
    AND log.original RLIKE "(?i).*(pending|submitted|under.*review|open).*"
    AND log.original NOT RLIKE "(?i).*(accepted|denied|completed|responded|disagreement.*noted).*"
  | STATS request_age_days = (NOW() - MIN(@timestamp)) / 86400000,
          request_details = VALUES(log.original),
          first_request = MIN(@timestamp)
    BY user.name, host.name
  | WHERE request_age_days > 60
  | EVAL risk_score = CASE(
      request_age_days > 120, 95,  
      request_age_days > 90, 85,   
      75
    )
  | KEEP user.name, host.name, request_age_days, first_request, request_details, risk_score
  | SORT request_age_days DESC
enabled: false
tags:
  - hipaa
  - privacy_rule
  - section_164_526
  - patient_rights
  - amendment
  - record_correction
severity: high
risk_score: 85
references:
  - "45 CFR §164.526 - Amendment of PHI"
  - "45 CFR §164.526(b)(2) - 60-Day Timeframe"
nist: ["IP-4"]
gdpr: ["Article 16"]
pci_dss: []
hipaa: ["164.526"]
mitre_attack: []
