rule_id: 2eb54f94-9ef9-4365-b3f3-805293eaaaef
#//RULE-HIPAA-18 — Confidential Communications Request Not Honored - §164.522(b)
#//Requirement: HIPAA Privacy Rule §164.522(b) - Confidential Communications
#//Objective: Detect communications sent to non-requested addresses
#//Data sources: Patient contact preference logs, mailing system logs
#//ECS fields used: event.original, event.original, user.name, event.action
#//Healthcare field validation: Verify EHR/EMR fields exist in your indices (event.original  # FIXME: patient.id not available, encounter.id, etc.)
#//Tuning notes: Track alternative communication preferences; verify request compliance

name: "PHI Sent to Non-Preferred Contact Method (Privacy Request Violation)"
description: |
  Identifies Protected Health Information communications sent to addresses or phone
  numbers other than those requested by patient under HIPAA §164.522(b) confidential
  communications requirement. Detects appointment reminders to home phone when
  patient requested work phone only, medical bills mailed to home address when
  patient specified PO Box, or test results emailed when patient requested secure
  portal only. Covered entities must accommodate reasonable confidential communication
  requests. Monitor communication channels and correlate with patient preferences.
type: esql
params: '{}'
schedule_interval: 12h
index:
  - winlogbeat-*
  - auditbeat-*
  - filebeat-ehr-*
  - filebeat-*
query_language: esql
query: |
  FROM filebeat-*
  | WHERE (
      (event.dataset RLIKE "(?i).*mail.*"
       AND event.original RLIKE "(?i).*(appointment|test.*result|medical|health|bill|invoice).*")
      OR
      (event.action RLIKE "(?i).*(sms|text|call|phone).*"
       AND event.original RLIKE "(?i).*(appointment|reminder|result|prescription).*")
      OR
      (event.original RLIKE "(?i).*(mail.*to|send.*to|address).*"
       AND event.original RLIKE "(?i).*(medical.*record|billing|statement).*")
    )
    AND event.original NOT RLIKE "(?i).*(preferred.*method|requested.*contact|alternative.*address|164.*522).*"
  | STATS communication_violations = COUNT(*),
          contact_methods = VALUES(event.original),
          recipients = VALUES(event.original)
    BY user.name, host.name
  | WHERE communication_violations > 3
  | EVAL risk_score = CASE(
      communication_violations > 10, 85,
      communication_violations > 5, 75,
      65
    )
  | KEEP agent_id, user.name, host.name, communication_violations, contact_methods, recipients, risk_score
  | SORT communication_violations DESC
enabled: false
tags:
  - hipaa
  - privacy_rule
  - section_164_522_b
  - patient_rights
  - confidential_communications
  - patient_preferences
severity: medium
risk_score: 70
references:
  - "45 CFR §164.522(b) - Confidential Communications"
  - "45 CFR §164.502 - Uses and Disclosures"
nist: ["IP-1"]
gdpr: []
pci_dss: []
hipaa: ["164.522.b"]
mitre_attack: []
