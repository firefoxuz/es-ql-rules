rule_id: be5fac42-f084-43cd-9bbb-1bba5d740f33
#//RULE-HIPAA-09 — ePHI Transmitted Without Integrity Verification - §164.312(c)(2)
#//Requirement: HIPAA Security Rule §164.312(c)(2) - Mechanism to Authenticate ePHI
#//Objective: Detect ePHI transmissions without checksums/digital signatures
#//Data sources: Network logs, file transfer logs, HL7 interface logs
#//ECS fields used: event.original, event.original, event.original, event.action
#//Healthcare field validation: Verify EHR/EMR fields exist in your indices (event.original  # FIXME: patient.id not available, encounter.id, etc.)
#//Tuning notes: Monitor HL7/FHIR interfaces; verify message integrity mechanisms

name: "ePHI Data Transfer Without Integrity Verification"
description: |
  Identifies transmission of ePHI without integrity verification mechanisms (checksums,
  hash values, digital signatures) as recommended by HIPAA §164.312(c)(2). Detects
  HL7 message transfers without MLLP checksums, FHIR API calls without integrity
  headers, file transfers of medical records without hash verification, or clinical
  data exchanges lacking digital signatures. Integrity verification prevents data
  corruption and tampering during transmission. Monitor healthcare interfaces and
  file transfer protocols for integrity controls.
type: esql
params: '{}'
schedule_interval: 30m
index:
  - winlogbeat-*
  - auditbeat-*
  - filebeat-ehr-*
  - filebeat-*
query_language: esql
query: |
  FROM filebeat-*
  | WHERE (
      (event.original RLIKE "(?i).*(hl7|mllp).*"
       AND event.original NOT RLIKE "(?i).*(checksum|hash|digest|signature).*")
      OR
      (event.action RLIKE "(?i).*(transfer|send|transmit|export).*"
       AND file.path RLIKE "(?i).*(patient|medical|ehr|phi|clinical|ccda|ccd).*"
       AND event.original.sha256 IS NULL)
      OR
      (event.original RLIKE "(?i).*/fhir/.*"
       AND event.original NOT RLIKE "(?i).*(digest|signature|integrity).*")
    )
    AND event.original > 10240
  | STATS unverified_transfers = COUNT(*),
          protocols = VALUES(event.original),
          files = VALUES(file.name),
          data_volume_mb = SUM(event.original) / 1048576,
          destinations = VALUES(event.original)
    BY host.name, event.original
  | WHERE unverified_transfers > 5
  | EVAL risk_score = CASE(
      data_volume_mb > 100, 90,
      unverified_transfers > 50, 85,
      80
    )
  | KEEP agent_id, host.name, event.original, unverified_transfers, data_volume_mb, protocols, files, risk_score
  | SORT unverified_transfers DESC
enabled: false
tags:
  - hipaa
  - security_rule
  - section_164_312_c_2
  - integrity
  - data_transmission
  - hl7_fhir
severity: high
risk_score: 85
references:
  - "45 CFR §164.312(c)(2) - Mechanism to Authenticate ePHI"
  - "45 CFR §164.312(e)(2)(i) - Integrity Controls for Transmission"
nist: ["SC-8"]
gdpr: ["32"]
pci_dss: ["4.1"]
hipaa: ["164.312.c.2"]
mitre_attack:
  TA0040:
    T1565: ["T1565.002"]