#//RULE-HIPAA-31 — Breach Affecting 500+ Not Reported to HHS/Media - §164.406, §164.408
#//Requirement: HIPAA Breach Notification §164.406 (HHS), §164.408 (Media)
#//Objective: Detect large breaches not reported to HHS and media
#//Data sources: Breach notification logs, regulatory reporting logs
#//ECS fields used: event.action, log.original, @timestamp
#//Tuning notes: Monitor for 500+ individual threshold; track HHS portal submissions

name: "RULE-HIPAA-31: Breach Affecting 500+ Individuals Not Reported to HHS/Media"
description: |
  Identifies breaches affecting 500 or more individuals that have not been reported
  to HHS Secretary (via breach portal) and prominent media outlets as required by
  HIPAA §164.406 and §164.408. Detects confirmed large-scale breaches without HHS
  breach portal submission records, media notifications not issued, or public
  disclosure not made. Breaches of ≥500 individuals require simultaneous notification
  to HHS and media without unreasonable delay (no later than 60 days). Large breach
  non-reporting results in public scrutiny and severe penalties. Monitor for
  500-person threshold crossings and regulatory reporting completion.
type: esql
params: '{}'
schedule_interval: 24h
index:
  - filebeat-*
query_language: esql
query: |
  FROM filebeat-*
  | WHERE log.original RLIKE "(?i).*(breach.*confirmed|incident.*affecting).*"
    AND (
      log.original RLIKE "(?i).*(500|[5-9][0-9]{2,}|[1-9][0-9]{3,}).*individual.*"
      OR log.original RLIKE "(?i).*(large.*scale|mass.*breach|significant.*breach).*"
    )
  | WHERE NOT log.original RLIKE "(?i).*(hhs.*portal|breach.*report.*submit|media.*notif|prominent.*media|164.*406|164.*408).*"
  | STATS breach_age_days = (NOW() - MIN(@timestamp)) / 86400000,
          breach_scope = VALUES(log.original),
          discovery_date = MIN(@timestamp)
    BY host.name
  | WHERE breach_age_days > 60
  | EVAL risk_score = CASE(
      breach_scope RLIKE "(?i).*([1-9][0-9]{4,}|10000).*", 100,  // >10,000 individuals
      breach_age_days > 90, 100,
      95
    )
  | KEEP host.name, breach_age_days, discovery_date, breach_scope, risk_score
  | SORT risk_score DESC
enabled: false
tags:
  - hipaa
  - breach_notification
  - section_164_406
  - section_164_408
  - hhs_reporting
  - media_notification
  - large_breach
severity: critical
risk_score: 100
references:
  - "45 CFR §164.406 - Notification to Secretary (HHS)"
  - "45 CFR §164.408 - Notification to Media"
  - "OCR Breach Portal Requirements"
nist: ["IR-6"]
gdpr: ["Article 33"]
pci_dss: []
hipaa: ["164.406, 164.408"]
mitre_attack: []