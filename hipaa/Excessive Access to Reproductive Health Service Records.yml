rule_id: b60a001b-4242-43fe-9c4f-427b84813bde
#//RULE-HIPAA-38 — Reproductive Health Services Access Logged - Privacy Concern
#//Requirement: HIPAA Privacy Rule - Sensitive Services
#//Objective: Detect potential privacy violations for reproductive health access
#//Data sources: EHR access logs, appointment scheduling logs
#//ECS fields used: event.action, event.original, service.type, event.original  # FIXME: diagnosis.code not available
#//Healthcare field validation: Verify EHR/EMR fields exist in your indices (event.original  # FIXME: patient.id not available, encounter.id, etc.)
#//Tuning notes: Flag sensitive services; monitor for inappropriate access patterns

name: "Excessive Access to Reproductive Health Service Records"
description: |
  Identifies patterns of access to reproductive health service records (abortion,
  contraception, fertility, STD treatment) that may indicate privacy violations,
  especially post-Dobbs decision with state-level legal implications. Detects
  unusual access volumes to OB/GYN charts, reproductive procedure documentation
  viewed by non-clinical staff, or access to sensitive diagnosis codes (Z30-Z33,
  O00-O08) without clear clinical need. While HIPAA doesn't specifically restrict
  these records, heightened sensitivity requires monitoring for potential misuse,
  unauthorized disclosure, or state law violations. Monitor reproductive health
  access patterns carefully.
type: esql
params: '{}'
schedule_interval: 15m
index:
  - winlogbeat-*
  - auditbeat-*
  - filebeat-ehr-*
query_language: esql
query: |
  FROM   | WHERE event.action RLIKE "(?i).*(record.*access|chart.*view|appointment.*view).*"
    AND (
      event.original RLIKE "(?i).*(reproductive|abortion|contraception|pregnancy.*termination|ob.*gyn|fertility|std|hiv|planned.*parenthood).*"
      OR event.original  # FIXME: diagnosis.code not available RLIKE ".*(Z30|Z31|Z32|Z33|O00|O01|O02|O03|O04|O07|O08|A50-A64).*"
    )
  | WHERE NOT event.original  # FIXME: user.role not available IN ("obgyn", "physician", "nurse_practitioner", "certified_nurse_midwife")
  | STATS sensitive_access = COUNT(*),
          accessing_users = VALUES(user.name),
          user_roles = VALUES(event.original  # FIXME: user.role not available),
          unique_patients = COUNT_DISTINCT(event.original  # FIXME: patient.id not available),
          service_types = VALUES(event.original  # FIXME: diagnosis.code not available)
    BY user.name, host.name
  | WHERE sensitive_access > 20 OR unique_patients > 10
  | EVAL risk_score = CASE(
      user_roles RLIKE "(?i).*(admin|billing|legal|compliance).*", 95,
      unique_patients > 50, 90,
      sensitive_access > 100, 85,
      80
    )
  | KEEP agent_id, user.name, host.name, sensitive_access, unique_patients, user_roles, service_types, risk_score
  | SORT sensitive_access DESC
enabled: false
tags:
  - hipaa
  - privacy_rule
  - reproductive_health
  - sensitive_services
  - privacy_protection
  - minimum_necessary
severity: high
risk_score: 90
references:
  - "45 CFR §164.502 - Uses and Disclosures"
  - "45 CFR §164.514(d) - Minimum Necessary"
  - "State Privacy Laws - Reproductive Health"
nist: ["AC-3"]
gdpr: ["9"]
pci_dss: []
hipaa: ["164.502, 164.514.d"]
mitre_attack:
  TA0009:
    T1530: []