rule_id: 8302e2f8-97b9-470d-84d2-0a6899c73b83
#//RULE-HIPAA-27 — Password Security Training Gap - Weak Password Detected - §164.308(a)(5)(ii)(D)
#//Requirement: HIPAA Security Rule §164.308(a)(5)(ii)(D) - Password Management
#//Objective: Detect weak passwords indicating training failure
#//Data sources: Authentication logs, password policy violation logs
#//ECS fields used: event.action, user.name, event.outcome, event.original
#//Healthcare field validation: Verify EHR/EMR fields exist in your indices (event.original  # FIXME: patient.id not available, encounter.id, etc.)
#//Tuning notes: Monitor password change events; detect policy violations

name: "Weak Password Used for ePHI Access (Training Failure)"
description: |
  Identifies weak passwords used to access ePHI systems, indicating failure of
  password management training required by HIPAA §164.308(a)(5)(ii)(D). Detects
  password changes rejected due to insufficient complexity, accounts with passwords
  matching common patterns (Password1, Summer2024), or authentication with known
  weak credentials. Password management training must cover creating, changing,
  and safeguarding passwords. Weak passwords on healthcare systems increase
  unauthorized access risk. Monitor password strength and correlate with training
  effectiveness.
type: esql
params: '{}'
schedule_interval: 12h
index:
  - winlogbeat-*
  - auditbeat-*
  - filebeat-ehr-*
  - winlogbeat-*
  - auditbeat-*
query_language: esql
query: |
  FROM winlogbeat-*, auditbeat-*
  | WHERE event.category == "iam"
    AND (
      (event.action IN ("changed-password", "reset-password", "password_change")
       AND event.outcome == "failure"
       AND event.original RLIKE "(?i).*(complexity|weak|simple|dictionary|common).*")
      OR
      (event.category == "authentication"
       AND event.original RLIKE "(?i).*(weak.*credential|common.*password|dictionary.*attack).*")
    )
    AND host.name RLIKE "(?i).*(emr|ehr|phi|clinical|medical).*"
  | STATS weak_password_events = COUNT(*),
          event_types = VALUES(event.action),
          failure_reasons = VALUES(event.original),
          affected_systems = VALUES(host.name)
    BY user.name, host.name
  | WHERE weak_password_events > 2
  | EVAL risk_score = CASE(
      weak_password_events > 5, 90,
      weak_password_events > 3, 80,
      70
    )
  | KEEP agent_id, user.name, host.name, weak_password_events, event_types, failure_reasons, risk_score
  | SORT weak_password_events DESC
enabled: false
tags:
  - hipaa
  - security_rule
  - section_164_308_a_5
  - password_management
  - security_training
  - authentication
severity: high
risk_score: 80
references:
  - "45 CFR §164.308(a)(5)(ii)(D) - Password Management"
  - "45 CFR §164.312(a)(2)(i) - Unique User Identification"
nist: ["IA-5"]
gdpr: []
pci_dss: ["8.2.3"]
hipaa: ["164.308.a.5.ii.D"]
mitre_attack:
  TA0001: 
    T1110: []