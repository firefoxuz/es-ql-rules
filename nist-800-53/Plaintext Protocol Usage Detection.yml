rule_id: de5f121d-5872-459e-a5d4-2469cb87039d
#//RULE-NIST-21 â€” Unencrypted Network Traffic (NIST SC-8, SC-13)
#//Control Family: SC (System and Communications Protection)
#//Objective: Detect sensitive data transmitted without encryption
#//Threat scenario: Credentials or PII transmitted in plaintext susceptible to interception
#//Data sources: Network traffic metadata, protocol analysis from packetbeat/filebeat
#//ECS fields used: event.original, event.original, event.original
#//Field validation: Verify all ECS fields exist in your indices before enabling
#//Tuning notes: Allowlist known legacy systems, adjust for environment-specific protocols
#
name: "Plaintext Protocol Usage Detection"
description: |
  Detects usage of unencrypted protocols (HTTP, FTP, Telnet) when encrypted alternatives exist.
  Transmission on ports 80, 21, 23 without TLS wrapper exposes data to man-in-the-middle attacks.
  Focus on authentication traffic (login forms, API keys) or sensitive applications.
  False positives: Internal monitoring systems, legacy applications, development environments.
  Triage: Identify transmitted data sensitivity, verify if communication is internal only,
  plan migration to encrypted alternatives (HTTPS, SFTP, SSH).
type: esql
params: '{}'
schedule_interval: 15m
index:
  - filebeat-*
  - auditbeat-*
query_language: esql
query: |
  FROM filebeat-*, auditbeat-*
  | WHERE event.original IN ("http", "ftp", "telnet")
    OR (event.original IN (80, 21, 23, 8080) AND event.original == "tcp")
  | WHERE event.original != "https" AND event.original != "ftps"
  | EVAL protocol_risk = CASE(
      event.original == "telnet" OR event.original == 23, "critical",
      event.original == "ftp" OR event.original == 21, "high",
      event.original == "http" OR event.original IN (80, 8080), "medium",
      "low"
    )
  | STATS 
      connection_count = COUNT(*),
      unique_destinations = COUNT_DISTINCT(event.original),
      destination_ips = VALUES(event.original),
      protocols_used = VALUES(event.original),
      ports = VALUES(event.original)
    BY host.name, source.ip, protocol_risk
    , bucket = DATE_TRUNC(30 minutes, @timestamp)
  | WHERE connection_count >= 5
  | EVAL risk_score = CASE(
      protocol_risk == "critical", connection_count * 30,
      protocol_risk == "high", connection_count * 20,
      connection_count * 10
    )
  | WHERE risk_score >= 50
  | KEEP bucket, host.name, source.ip, protocol_risk, connection_count, unique_destinations, destination_ips, protocols_used, risk_score
  | SORT risk_score DESC
enabled: false
tags:
  - nist_800_53
  - control_SC-8
  - control_SC-13
  - family_SC
  - network
  - encryption
  - policy_violation
severity: high
risk_score: 65
references:
  - "NIST SP 800-53 Rev.5 SC-8: Transmission Confidentiality and Integrity"
  - "MITRE ATT&CK T1040: Network Sniffing"
nist: ["SC-8", "SC-13"]
gdpr: "32"
pci_dss: "4.1"
mitre_attack:
  TA0006:
    T1040: []