rule_id: 171455ee-5bce-48ef-bee4-d71161147196

name: "Audit System Failure or Attack"
description: |
  Detects abnormal volume of failed audit events which may indicate audit system under attack,
  misconfiguration, or deliberate log flooding to hide malicious activity.
  Sudden spike in failures (>100 in 5 min) suggests either DoS or audit tampering.
  False positives: Legitimate system errors during patching, disk full conditions, network issues.
  Triage: Check disk space on log partition, review for concurrent attacks, verify audit service health.
type: esql
params: '{}'
schedule_interval: 5m
index:
  - logs-winlog*
  - logs-audit*
query_language: esql
query: |
  FROM logs-winlog*, logs-audit*
  | WHERE event.outcome == "failure"
  | STATS 
      total_failures = COUNT(*),
      unique_event_types = COUNT_DISTINCT(event.code),
      failure_categories = VALUES(event.category)
    BY host.name
    , bucket = DATE_TRUNC(5 minutes, @timestamp)
  | WHERE total_failures >= 100
  | EVAL anomaly_score = total_failures / 10
  | EVAL severity_level = CASE(
      total_failures >= 1000, "critical",
      total_failures >= 500, "high",
      "medium"
    )
  | KEEP agent_id, bucket, host.name, total_failures, unique_event_types, failure_categories, anomaly_score, severity_level
  | SORT anomaly_score DESC
enabled: false
tags:
  - nist_800_53
  - control_AU-6
  - family_AU
  - impact
  - availability
severity: medium
risk_score: 55
references:
  - "NIST SP 800-53 Rev.5 AU-6: Audit Record Review, Analysis, and Reporting"
nist: ["AU-6"]
pci_dss: ["10.6"]
gdpr: []
mitre_attack: []