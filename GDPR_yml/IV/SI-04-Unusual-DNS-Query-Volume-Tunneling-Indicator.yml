name: Unusual DNS Query Volume (Tunneling Indicator)
description: |
  Detects abnormally high DNS query count (100+ in 5 minutes) from single host, potential DNS tunneling.
type: esql
params: '{}'
schedule_interval: 5m
index:
  - metricbeat-*
query_language: esql
query: |
  FROM metricbeat-*
  | WHERE @timestamp >= NOW() - 5 minutes
  | WHERE network.protocol == "dns" OR destination.port == 53
  | STATS 
      dns_count = COUNT(*),
      unique_domains = COUNT_DISTINCT(dns.question.name)
    BY source.ip, host.name
  | WHERE dns_count >= 100
  | EVAL severity = "high"
  | KEEP @timestamp, source.ip, host.name, dns_count, unique_domains, severity
enabled: false
tags:
  - system-integrity
severity: high
risk_score: 75
# MITRE ATT&CK: tactic external_id -> technique external_id -> [subtechnique external_ids]
mitre_attack: {}
nist: []
gdpr: ["IV.32.1.b", "IV.33"]
pci-dss: []
hipaa: []
