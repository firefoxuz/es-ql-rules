name: Successful Login After Multiple Failures - Windows
description: |
  Detects successful Windows logon (Event ID 4624) following 3+ failed attempts (Event ID 4625) within 10 minutes.
type: esql
params: '{}'
schedule_interval: 10m
index:
  - winlogbeat-*
  - filebeat-*
query_language: esql
query: |
  FROM winlogbeat-*, filebeat-*
  | WHERE @timestamp >= NOW() - 10 minutes
  | WHERE event.category == "authentication"
  | STATS 
      failures = COUNT_IF(event.outcome == "failure"),
      successes = COUNT_IF(event.outcome == "success"),
      max_time = MAX(@timestamp)
    BY source.ip, user.name, host.name
  | WHERE failures >= 3 AND successes >= 1
  | EVAL severity = "high"
  | KEEP max_time, source.ip, user.name, host.name, failures, successes, severity
enabled: false
tags:
  - access-control
severity: high
risk_score: 75
# MITRE ATT&CK: tactic external_id -> technique external_id -> [subtechnique external_ids]
mitre_attack: {}
nist: ["AC-7", "AU-2"]
gdpr: ["IV.32.1.b", "IV.33"]
pci-dss: []
hipaa: []
