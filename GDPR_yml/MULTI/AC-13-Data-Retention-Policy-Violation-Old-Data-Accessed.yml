name: Data Retention Policy Violation (Old Data Accessed)
description: |
  Detects access to data older than retention policy allows (e.g., >7 years for financial data).
type: esql
params: '{}'
schedule_interval: 24h
index:
  - auditbeat-*
  - filebeat-*
query_language: esql
query: |
  FROM auditbeat-*, filebeat-*
  | WHERE @timestamp >= NOW() - 24 hours
  | WHERE event.action IN ("accessed", "read")
    AND file.path RLIKE ".*(archive|backup|old_data|20[0-1][0-7]).*"
  | EVAL file_age_days = (@timestamp - file.created) / 86400000
  | WHERE file_age_days > 2555
  | EVAL severity = "medium"
  | KEEP @timestamp, user.name, file.path, file.created, file_age_days, severity
enabled: false
tags:
  - access-control
severity: medium
risk_score: 50
# MITRE ATT&CK: tactic external_id -> technique external_id -> [subtechnique external_ids]
mitre_attack: {}
nist: []
gdpr: ["II.5.1.e", "III.17"]
pci-dss: []
hipaa: []
