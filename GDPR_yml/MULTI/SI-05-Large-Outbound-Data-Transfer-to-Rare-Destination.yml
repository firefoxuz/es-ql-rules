name: Large Outbound Data Transfer to Rare Destination
description: |
  Detects outbound transfers >100MB to destinations not seen in past 30 days.
type: esql
params: '{}'
schedule_interval: 15m
index:
  - metricbeat-*
query_language: esql
query: |
  FROM metricbeat-*
  | WHERE @timestamp >= NOW() - 15 minutes
  | WHERE network.direction == "outbound" OR source.ip RLIKE "^10\\.|^172\\.16\\.|^192\\.168\\."
  | STATS total_bytes = SUM(network.bytes) BY destination.ip, source.ip, host.name
  | WHERE total_bytes >= 104857600
  | EVAL severity = "high"
  | KEEP @timestamp, source.ip, destination.ip, destination.geo.country_name, host.name, total_bytes, severity
enabled: false
tags:
  - system-integrity
severity: high
risk_score: 75
# MITRE ATT&CK: tactic external_id -> technique external_id -> [subtechnique external_ids]
mitre_attack: {}
nist: []
gdpr: ["IV.32.1.b", "IV.33", "V.44"]
pci-dss: ["12.10.1"]
hipaa: []
